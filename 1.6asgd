æ˜ç™½äº†ï¼Œè¿™ä¸ªé”™è¯¯æ˜¯ FIS æŠ¥çš„éå¸¸å…¸å‹çš„â€œtarget å’Œ action å¯¹ä¸ä¸Šâ€é—®é¢˜ã€‚æˆ‘ç»™ä½ è¯¦ç»†æ‹†å¼€åŸå› å’Œè§£å†³åŠæ³•ã€‚
ä¸€ã€æŠ¥é”™åˆ†æ
é”™è¯¯ä¿¡æ¯ï¼š
å¤åˆ¶ä»£ç 

unexpected target instance found in action injectInsufficientCapacity
ç¿»è¯‘å°±æ˜¯ï¼š
â€œåœ¨ä½ é…ç½®çš„ action injectInsufficientCapacity æ—¶ï¼ŒFIS å‘ç°äº†ä¸ç¬¦åˆè¦æ±‚çš„ targetâ€
åŸå› ï¼š
API action aws:ec2:api-insufficient-instance-capacity-error æœ‰ä¸¥æ ¼ target ç±»å‹è¦æ±‚
å®ƒä¸èƒ½ç›´æ¥å¯¹å•ä¸ª EC2 instance æ³¨å…¥ã€‚
å®ƒåªå…è®¸ target æ˜¯ instance type + AZ ç»´åº¦ æˆ– ASGã€‚
ä½ çš„ template é‡Œå¯èƒ½ï¼š
æŠŠ target è®¾ç½®æˆ EC2 instance ID
æˆ–è€… selectionMode / filters ç”¨æ³•ä¸å¯¹
æ‰€ä»¥ FIS æŠ¥é”™ â€œunexpected target instanceâ€
äºŒã€å®˜æ–¹è§„åˆ™ï¼ˆFIS API Action çº¦æŸï¼‰
Action
å¯æ¥å—çš„ Target ç±»å‹
aws:ec2:api-insufficient-instance-capacity-error
aws:ec2:instance ä½†å¿…é¡»æŒ‰ AZ + instanceType ç­›é€‰ï¼Œä¸èƒ½ç›´æ¥ç”¨ instance ID
aws:ec2:asg-insufficient-instance-capacity-error
aws:autoscaling:autoScalingGroup
ğŸ”‘ æ ¸å¿ƒç‚¹
ä½ ä¸èƒ½ç›´æ¥æŒ‡å®š "Targets": {"Instances": ["i-xxxx"]}
å¿…é¡»é€šè¿‡ filtersï¼ˆAZï¼‰ + instanceType + percentage æ¥é—´æ¥é€‰æ‹©
ä¸‰ã€æ­£ç¡®çš„é…ç½®æ–¹å¼ï¼ˆJSON ç¤ºä¾‹ï¼‰
å‡è®¾ä½ çš„ç›®æ ‡ AZ æ˜¯ ap-southeast-2aï¼Œä½ è¦è¦†ç›– m5.largeï¼Œ50% çš„ targetï¼š
å¤åˆ¶ä»£ç 
Json
{
  "targets": {
    "CapacityTargets": {
      "resourceType": "aws:ec2:instance",
      "resourceTags": {
        "ChaosTest": "AZ-Outage"
      },
      "filters": [
        {
          "path": "Placement.AvailabilityZone",
          "values": ["ap-southeast-2a"]
        }
      ],
      "selectionMode": "PERCENT(50)"
    }
  },
  "actions": {
    "InjectInsufficientCapacity": {
      "actionId": "aws:ec2:api-insufficient-instance-capacity-error",
      "parameters": {
        "availabilityZone": "ap-southeast-2a",
        "instanceType": "m5.large",
        "duration": "PT10M"
      },
      "targets": {
        "Instances": "CapacityTargets"
      }
    }
  }
}
âœ… å…³é”®ç‚¹ï¼š
targets.CapacityTargets.resourceType = aws:ec2:instance
ä¸èƒ½ç›´æ¥å¡«å®ä¾‹ ID
ç”¨ filters + selectionMode æ§åˆ¶èŒƒå›´
action å‚æ•°é‡Œå¿…é¡»æŒ‡å®š instanceType å’Œ availabilityZone
å››ã€å¸¸è§è¸©å‘ç‚¹
ç›´æ¥å¡«å®ä¾‹ ID
å¤åˆ¶ä»£ç 
Json
"Targets": {
  "Instances": ["i-1234567890abcdef0"]
}
â†’ âŒ  FIS ä¸å…è®¸
AZ ä¸ä¸€è‡´
filters é‡Œæ˜¯ ap-southeast-2aï¼Œparametersé‡Œåˆæ˜¯ ap-southeast-2b
â†’ âŒ  ä¼šæŠ¥åŒæ ·é”™è¯¯
å¿˜è®° instanceType
action ä¸å¸¦ instanceType
â†’ âŒ  å¿…é¡»å¡«
äº”ã€è§£å†³æ–¹æ¡ˆæ€»ç»“
ä¸è¦æŒ‡å®šå®ä¾‹ ID
ç”¨ AZ filter + instanceType
åŠ  selectionMode æˆ– percentageï¼Œå¦åˆ™ target ä¸ºç©º
ä¿è¯ action å‚æ•°å’Œ target AZ ä¸€è‡´
å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç›´æ¥å†™ä¸€ä»½å¯è¿è¡Œçš„ FIS templateï¼Œ
è¦†ç›–ä½ ç°æœ‰ä¸‰å° EC2
å¯é€‰ 50% æ³¨å…¥ capacity error
ä¸ç”¨ ASG / è‡ªåŠ¨æ‰©ç¼©
è¿™æ ·ä½ å°±ä¸ä¼šå†é‡åˆ° â€œunexpected target instanceâ€ é”™äº†ã€‚
ä½ å¸Œæœ›æˆ‘å¸®ä½ ç›´æ¥å†™å—ï¼Ÿ