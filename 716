å¥½çš„ï¼Œä½ é‡åˆ°çš„ GitLab æŠ¥é”™ï¼š

> âŒ configuration is invalid



è¯´æ˜ä½ çš„ .gitlab-ci.yml æˆ– cycle.yaml æ–‡ä»¶åœ¨ç»“æ„ä¸Š ä¸æ˜¯åˆæ³•çš„ GitLab CI é…ç½®ï¼Œè€Œä¸ä»…ä»…æ˜¯è·¯å¾„æˆ–å˜é‡é—®é¢˜ã€‚æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥æ’æŸ¥å¹¶è§£å†³ã€‚


---

âœ… æœ€å¯èƒ½åŸå› æ±‡æ€»ï¼ˆä¾æ¬¡æ£€æŸ¥ï¼‰


---

âœ… 1. include: ç”¨æ³•ä¸å¯¹ï¼ˆè¯­æ³•é”™è¯¯ï¼‰

âœ… æ­£ç¡®å†™æ³• 1ï¼ˆæœ¬åœ° includeï¼‰ï¼š

# .gitlab-ci.yml
include:
  - local: 'cycle.yaml'

> â›” é”™è¯¯å†™æ³•ï¼ˆç¼©è¿›æˆ–å­—æ®µåé”™ï¼‰ï¼š



include:
    local: 'cycle.yaml'  # âŒ é”™ï¼Œç¼ºå°‘ "-"ï¼ŒGitLab æœŸæœ›åˆ—è¡¨


---

âœ… 2. cycle.yaml æ–‡ä»¶ä¸æ˜¯åˆæ³•çš„ GitLab CI é…ç½®ï¼ˆæ¯”å¦‚ç¼ºå°‘ job å®šä¹‰ï¼‰

GitLab è¦æ±‚ .gitlab-ci.yml å’Œä»»ä½• include æ–‡ä»¶å¿…é¡»æ˜¯ å®Œæ•´çš„ GitLab CI ç»“æ„ï¼ˆjob å + é…ç½®ï¼‰ã€‚

â›” é”™è¯¯ä¾‹å­ï¼ˆåªæœ‰ scriptï¼Œæ²¡æœ‰ job åï¼‰ï¼š

# cycle.yaml âŒ é”™è¯¯
script:
  - echo "hello"

âœ… æ­£ç¡®ä¾‹å­ï¼ˆå¿…é¡»æœ‰ job åï¼‰ï¼š

# cycle.yaml âœ… æ­£ç¡®
deploy_cycle:
  stage: deploy
  image: amazon/aws-cli
  before_script:
    - aws eks update-kubeconfig --region $AWS_REGION --name $EKS_CLUSTER_NAME
  script:
    - kubectl get pods


---

âœ… 3. ç¼ºå°‘ stages:ï¼Œå¯¼è‡´ stage ä¸å­˜åœ¨

GitLab è¦æ±‚æ‰€æœ‰ job çš„ stage: å‡ºç°åœ¨ stages: åˆ—è¡¨ä¸­ã€‚

âœ… æ­£ç¡®å†™æ³•ï¼š

# .gitlab-ci.yml
stages:
  - deploy

include:
  - local: 'cycle.yaml'

â›” é”™è¯¯ä¾‹å­ï¼ˆæ²¡å®šä¹‰ stageï¼‰ï¼š

# .gitlab-ci.yml
include:
  - local: 'cycle.yaml'
# æ²¡æœ‰ stagesï¼Œcycle.yaml ä¸­ job çš„ stage æ‰¾ä¸åˆ°


---

âœ… 4. cycle.yaml æœ‰ YAML è¯­æ³•é”™è¯¯

æ¯”å¦‚é”™ç”¨å†’å·ã€ç¼©è¿›é”™ã€ç”¨äº† tab ç­‰ã€‚

âœ… æ£€æŸ¥æ–¹å¼ï¼š

ä½ å¯ä»¥æœ¬åœ°è¿è¡Œï¼š

gitlab-ci-lint < .gitlab-ci.yml

æˆ–è€…åœ¨ GitLab Web ç•Œé¢æ‰“å¼€é¡¹ç›®ï¼š

è¿›å…¥ CI/CD > Editor

ç‚¹å‡»å³ä¸Šè§’ Validate æŒ‰é’®ï¼Œä¼šæŒ‡å‡ºå“ªä¸€è¡Œè¯­æ³•é”™



---

âœ… æœ€å°å¯è¿è¡Œç»“æ„ç¤ºä¾‹ï¼ˆä½ å¯ä»¥å¯¹ç…§è°ƒè¯•ï¼‰

ä¸» .gitlab-ci.ymlï¼š

include:
  - local: 'cycle.yaml'

stages:
  - deploy

variables:
  AWS_REGION: ap-southeast-2
  EKS_CLUSTER_NAME: my-cluster

è¢«å¼•å…¥çš„ cycle.yamlï¼š

deploy_cycle:
  stage: deploy
  image: amazon/aws-cli
  before_script:
    - aws eks update-kubeconfig --region $AWS_REGION --name $EKS_CLUSTER_NAME
  script:
    - echo "Deploying to EKS $EKS_CLUSTER_NAME"
    - kubectl get pods


---

ğŸ§© å¦‚æœä½ è´´å‡ºè¿™å‡ éƒ¨åˆ†ï¼Œæˆ‘å¯ä»¥ç«‹å³å¸®ä½ ä¿®å¤ï¼š

1. .gitlab-ci.yml çš„å‰ 15 è¡Œ


2. cycle.yaml çš„å…¨éƒ¨å†…å®¹ï¼ˆæˆ–å‡ºé”™ job éƒ¨åˆ†ï¼‰


3. æŠ¥é”™æˆªå›¾æˆ–æ–‡å­—ï¼ˆæœ€å¥½æ˜¯ GitLab æ ¡éªŒå™¨æŠ¥å‡ºæ¥å“ªè¡Œï¼‰




---

å‡†å¤‡å¥½æˆ‘å¸®ä½ é€è¡Œæ£€æŸ¥ï¼Œåªéœ€è¦ä½ è´´ä¸€ä¸‹ YAML æ–‡ä»¶ã€‚æˆ–è€…ï¼Œæˆ‘å¯ä»¥ç»™ä½ ä¸€ä¸ªå¹²å‡€å¯è¿è¡Œçš„æ¨¡æ¿ï¼Œç›´æ¥å¤åˆ¶è°ƒè¯•ã€‚ä½ å¸Œæœ›å“ªç§ï¼Ÿ

