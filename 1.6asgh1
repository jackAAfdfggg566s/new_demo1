æ˜ç™½äº†ï¼Œä½ å¸Œæœ›åœ¨ EKS NodeGroup / ASG çš„ FIS æ¨¡æ¿é‡Œï¼Œé™¤äº†é€šè¿‡ NodeGroup tag æŒ‡å®šï¼Œè¿˜è¦ åªå½±å“ç‰¹å®š AZï¼ˆä¾‹å¦‚ 2aï¼‰ã€‚
è¿™é‡Œéœ€è¦æ³¨æ„ï¼š
ä¸€ã€ASG + AZ çš„è¡Œä¸º
NodeGroup å¯¹åº”çš„ ASG æœ¬èº«å¯ä»¥è·¨å¤šä¸ª AZ
asg-insufficient-instance-capacity-error ä½œç”¨åœ¨ ASG launch å¤±è´¥ï¼ŒFIS å¹¶ä¸ç›´æ¥å¯¹å•ä¸ªå®ä¾‹æ³¨å…¥
FIS ä¸ç›´æ¥æ”¯æŒåœ¨ target é‡Œ filter AZ
ä¹Ÿå°±æ˜¯è¯´ targets.filters.Placement.AvailabilityZone å¯¹ ASG target æ— æ•ˆ
FIS ä¼šéšæœºé€‰æ‹© ASG ä¸­çš„å®ä¾‹ï¼Œä½†ä½ å¯ä»¥ç”¨ parameters.overrideAZï¼ˆéƒ¨åˆ† action æ”¯æŒï¼‰æˆ–æ‰‹åŠ¨æ‹†æˆå• AZ çš„ ASG
äºŒã€å¯è¡Œæ–¹æ¡ˆ
æ–¹æ¡ˆ 1ï¼šå• AZ NodeGroup
å¦‚æœä½ çš„ NodeGroup å·²ç»åªåœ¨ ap-southeast-2a
ä½¿ç”¨ä¹‹å‰çš„ templateï¼Œè‡ªç„¶åªä¼šå½±å“ 2a å®ä¾‹
æ–¹æ¡ˆ 2ï¼šæ‹†åˆ† NodeGroupï¼ˆå¯é€‰ï¼‰
å¦‚æœ NodeGroup è·¨å¤šä¸ª AZ
åˆ›å»º åªåŒ…å« 2a çš„ NodeGroup / ASG
åœ¨ FIS template target ä¸Šç”¨ tag æŒ‡å®šè¿™ä¸ªå• AZ NodeGroup
è¿™æ ·å°±åªå½±å“ 2a
ä¸‰ã€JSON ç¤ºä¾‹ï¼ˆå• AZ NodeGroupï¼‰
å¤åˆ¶ä»£ç 
Json
{
  "description": "FIS experiment: simulate insufficient capacity on EKS NodeGroup in AZ 2a",
  "targets": {
    "NodeGroupASG": {
      "resourceType": "aws:autoscaling:autoScalingGroup",
      "resourceTags": {
        "eks:nodegroup-name": "YOUR_NODEGROUP_NAME" 
      },
      "selectionMode": "PERCENT(50)"
    }
  },
  "actions": {
    "InjectInsufficientCapacity": {
      "actionId": "aws:ec2:asg-insufficient-instance-capacity-error",
      "parameters": {
        "duration": "PT10M"
      },
      "targets": {
        "ASG": "NodeGroupASG"
      }
    }
  }
}
ğŸ”‘ é‡ç‚¹ï¼šå¦‚æœ NodeGroup è·¨å¤šä¸ª AZï¼ŒFIS ä¼šéšæœºé€‰æ‹© ASG å†…å®ä¾‹ï¼Œä¸èƒ½ç›´æ¥åœ¨ template é‡Œ filter AZ
å››ã€ç»“è®º
asg-insufficient-instance-capacity-error æ— æ³•åœ¨ FIS template é‡Œç›´æ¥æŒ‰ AZ filter
æ§åˆ¶ AZ çš„æ–¹æ³•ï¼š
NodeGroup/ASG æœ¬èº«åªéƒ¨ç½²åœ¨ç›®æ ‡ AZï¼ˆæ¨èï¼‰
æ‹†åˆ† NodeGroupï¼ŒæŒ‰ AZ åˆ›å»ºå•ç‹¬ ASG
å¦‚æœä½ éœ€è¦ï¼Œæˆ‘å¯ä»¥å¸®ä½ å†™ä¸€ä¸ª å¯ç›´æ¥è¿è¡Œçš„ FIS template + CLI å‘½ä»¤ï¼Œ
é’ˆå¯¹ä½ çš„ NodeGroup
ç¡®ä¿åªå½±å“ AZ 2aï¼ˆå‰ææ˜¯ NodeGroup åªåœ¨ 2aï¼‰
50% æ³¨å…¥å®¹é‡ä¸è¶³
ä½ å¸Œæœ›æˆ‘å¸®ä½ ç›´æ¥å†™å—ï¼Ÿ