👌 明白了，你重点是 Database Insights，而不是 Performance Insights。

⚠️ 要注意：

Database Insights（CloudWatch → Database Insights）本质上是 CloudWatch Metrics + Logs 的可视化聚合。

它并 没有单独的 API（不像 pi:GetResourceMetrics 那样）。

所以你如果不启用 Performance Insights，是 不能直接调用 Top SQL API 的。



---

✅ 那么你能做的有两条路：

方法 1：直接用 CloudWatch Metrics

Database Insights 里的一些核心指标（CPUUtilization、FreeableMemory、DatabaseConnections、ReadIOPS、WriteIOPS、CommitLatency 等）已经在 CloudWatch 里有对应指标。

你可以在 CloudWatch → Metrics → RDS 里找到并直接加到 Dashboard。

这些不需要 Performance Insights，所有实例都会有。


👉 但是，Top SQL 这种指标（SQLId, Calls, Latency）是 只有 Performance Insights 才能拿到的。


---

方法 2：CloudWatch Logs + 自定义处理

Database Insights 页面还会用到 Enhanced Monitoring / Performance Schema / DMV（取决于 MySQL / Postgres / SQL Server）。

如果你不开启 Performance Insights，Top SQL 不会有 API，但你可以：

1. 打开 Enhanced Monitoring 或 Database Engine Logs (general log, slow query log)


2. 把日志流送到 CloudWatch Logs


3. 用 Logs Insights 或 Lambda 分析 SQL 语句耗时、执行次数


4. 再写到 CloudWatch 自定义指标（模拟 “Top SQL”）




👉 这种方法的效果类似 Database Insights 的 “Top SQL”，但要你自己处理日志。


---

🚦结论

如果你坚持不开 Performance Insights：

能拿到的 → 普通数据库指标（CPU、连接数、IOPS、Latency 等）

拿不到的 → Top SQL（这个必须要 Performance Insights）


Database Insights 控制台里展示的 Top SQL 区块，其实就是调用 PI API 的结果。



---

要不要我帮你列一个 清单，告诉你哪些 Database Insights 指标能直接从 CloudWatch 拿（不用开 PI），哪些一定要开 PI 才行？

