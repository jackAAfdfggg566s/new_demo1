å¦‚æœä½ åªæœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ Podï¼Œä½†ä¸çŸ¥é“å®ƒæ˜¯ç”±å“ªä¸ª Helm chart éƒ¨ç½²çš„ï¼Œå¯ä»¥é€šè¿‡å®ƒå¸¦çš„ label æ‰¾åˆ° release åå­— å’Œ chart åå­—ã€‚


---

âœ… ç¬¬ä¸€æ­¥ï¼šçœ‹ Pod ä¸Šçš„ Helm æ ‡è¯† label

kubectl get pod <pod-name> -n <namespace> -o jsonpath='{.metadata.labels}'

å¦‚æœå®ƒæ˜¯ Helm å®‰è£…çš„ï¼Œä¸€èˆ¬ä¼šçœ‹åˆ°è¿™äº› labelï¼š

label key	å«ä¹‰

app.kubernetes.io/instance	release åï¼ˆHelm install æ—¶çš„åå­—ï¼‰
app.kubernetes.io/managed-by=Helm	ç¡®è®¤æ˜¯ Helm ç®¡ç†
helm.sh/chart	chart åå’Œç‰ˆæœ¬


ä¾‹å¦‚è¾“å‡ºç±»ä¼¼ï¼š

"app.kubernetes.io/instance":"my-app",
"helm.sh/chart":"nginx-13.2.1",
"app.kubernetes.io/managed-by":"Helm"


---

âœ… ç¬¬äºŒæ­¥ï¼šæ ¹æ® release æ‰¾åˆ° Helm chart

helm list -A | grep <instance-name>

ä¾‹å¦‚ï¼š

helm list -A | grep my-app

ä½ å°±ä¼šå¾—åˆ°ï¼š

NAME	NAMESPACE	CHART	VERSION

my-app	prod	nginx-13.2.1	13.2.1



---

âœ… ç¬¬ä¸‰æ­¥ï¼šæŸ¥çœ‹è¯¥ release çš„æ¸²æŸ“ manifestï¼ˆå·²ç»å®‰è£…åˆ°é›†ç¾¤é‡Œçš„ï¼‰

helm get manifest my-app -n prod

è¿™å°±æ˜¯ Helm chart æ¸²æŸ“åçš„æœ€ç»ˆæ–‡ä»¶ï¼Œå¯ç›´æ¥çœ‹åˆ° PodSpec å®šä¹‰ã€‚


---

âœ… ç¬¬å››æ­¥ï¼šå¦‚æœæƒ³ç›´æ¥æŸ¥çœ‹ chart æºç ï¼ˆæ¨¡æ¿ï¼‰

Helm è‡ªèº«ä¸å­˜æºç æ¨¡æ¿ï¼Œä½†å¦‚æœä½ æƒ³æ‹‰å› chart æºç ï¼ˆå¿…é¡» chart å¯ä» repo ä¸‹è½½ï¼‰

helm pull <chart-name> --version <version> --untar

ä¾‹å¦‚ï¼š

helm pull nginx --version 13.2.1 --untar

ç„¶åå°±å¯ä»¥çœ‹åˆ°ï¼š

nginx/
 â””â”€â”€ templates/
     â”œâ”€â”€ deployment.yaml
     â”œâ”€â”€ service.yaml
     â”œâ”€â”€ _helpers.tpl
     ...


---

ğŸ‘‡ ä¸€æ¡å‘½ä»¤æ€»ç»“ï¼ˆæœ€å¸¸ç”¨ï¼‰

ç›´æ¥æŸ¥ chart å + release åï¼š

kubectl get pod <pod> -n <ns> -o jsonpath='{.metadata.labels.helm\.sh/chart}{"\n"}{.metadata.labels.app\.kubernetes\.io/instance}{"\n"}'


---

å¦‚æœä½ æŠŠ pod åå’Œ namespace å‘æˆ‘ï¼ˆæˆ–æ‰§è¡Œä¸Šé¢ç¬¬ä¸€æ¡å‘½ä»¤çš„è¾“å‡ºå‘æˆ‘ï¼‰ï¼Œæˆ‘å¯ä»¥å¸®ä½ ï¼š

ç¡®è®¤å®ƒåˆ°åº•æ˜¯ä¸æ˜¯ Helm éƒ¨ç½²

å¯¹åº” Helm release å

å¯¹åº” chart å

å¯ä»¥ç›´æ¥åˆ†æå®ƒçš„ chart ä¸­ PodSpec åœ¨æ¨¡æ¿çš„ä½ç½®æ–‡ä»¶


ç›´æ¥å‘ï¼š

kubectl get pod <pod> -n <ns> -o jsonpath='{.metadata.labels}'

è¾“å‡ºç»™æˆ‘å³å¯ï¼Œæˆ‘ç»§ç»­å¸®ä½ ä¸‹ä¸€æ­¥ã€‚

