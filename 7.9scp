éå¸¸å¥½ï¼ä½ æƒ³å®ç°çš„å®Œæ•´ç›®æ ‡æ˜¯ï¼š

> âœ… åœ¨ GitLab CI ä¸­è¿è¡Œè„šæœ¬ï¼Œè„šæœ¬ä¼šåœ¨è¿œç«¯ç”Ÿæˆæ—¥å¿—æ–‡ä»¶ï¼ˆæ¯”å¦‚ .log, .summaryï¼‰
âœ… ç„¶åå°†è¿™äº›æ–‡ä»¶é€šè¿‡ scp æ‹·è´å› GitLab runner æœ¬åœ°
âœ… æœ€åæŠŠå®ƒä»¬ ä¿å­˜ä¸º GitLab artifacts



æˆ‘ä¸€æ­¥ä¸€æ­¥å¸®ä½ æ­å¥½ï¼Œåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š


---

âœ… ç¬¬ 1 æ­¥ï¼šè„šæœ¬åœ¨è¿œç«¯ç”Ÿæˆæ—¥å¿—æ–‡ä»¶ï¼ˆä½ å·²æœ‰ï¼‰

æ¯”å¦‚è¿œç«¯ç”Ÿæˆäº†è¿™äº›æ–‡ä»¶ï¼š

/opt/app/app.log
/opt/app/app.summary


---

âœ… ç¬¬ 2 æ­¥ï¼šä» GitLab CI runner ä½¿ç”¨ scp æ‹‰å›è¿™äº›æ–‡ä»¶

ä½ åœ¨ .gitlab-ci.yml çš„ script ä¸­è¿™æ ·å†™ï¼š

ğŸ§¾ .gitlab-ci.yml ç¤ºä¾‹

stages:
  - run
  - collect

variables:
  REMOTE_USER: jack
  REMOTE_HOST: 192.168.1.100
  REMOTE_PASS: $SSH_PASS   # åœ¨ GitLab Secret é‡Œè®¾ç½®è¿™ä¸ªå˜é‡

run_java:
  stage: run
  script:
    - chmod +x run_and_monitor.sh
    - ./run_and_monitor.sh

collect_logs:
  stage: collect
  script:
    # åˆ›å»ºæœ¬åœ°ç›®å½•ä¿å­˜æ—¥å¿—
    - mkdir -p logs
    # ä»è¿œç«¯æ‹‰æ—¥å¿—æ–‡ä»¶å›æ¥
    - sshpass -p "$REMOTE_PASS" scp -o StrictHostKeyChecking=no "$REMOTE_USER@$REMOTE_HOST:/opt/app/*.log" logs/ || true
    - sshpass -p "$REMOTE_PASS" scp -o StrictHostKeyChecking=no "$REMOTE_USER@$REMOTE_HOST:/opt/app/*.summary" logs/ || true
  artifacts:
    paths:
      - logs/
    expire_in: 1 week


---

âœ… ç¬¬ 3 æ­¥ï¼šä¿å­˜ä¸º GitLab CI çš„ artifacts

è¿™éƒ¨åˆ†åœ¨ä¸Šé¢çš„ collect_logs job é‡Œå·²ç»é…ç½®å¥½äº†ï¼š

artifacts:
  paths:
    - logs/
  expire_in: 1 week

è¿™æ ·ï¼Œåœ¨ GitLab job æ‰§è¡Œå®Œåï¼Œä½ å°±å¯ä»¥åœ¨ Job é¡µé¢ä¸‹è½½ logs/ ç›®å½•ä¸‹çš„æ—¥å¿—æ–‡ä»¶äº†ã€‚


---

ğŸ“ ç»“æœï¼š

æ–‡ä»¶	å­˜æ”¾ä½ç½®	

app.log, app.summary	è¿œç«¯ç”Ÿæˆ /opt/app/	
logs/*.log, logs/*.summary	æ‹‰å›åˆ° GitLab CI runner	
Artifacts	ä¿ç•™åœ¨ GitLab Job ä¸­å¯ä¸‹è½½	



---

âš ï¸ å¸¸è§é—®é¢˜

é—®é¢˜	è§£å†³æ–¹å¼

scp æç¤ºæƒé™	ç¡®ä¿ç›®æ ‡ç”¨æˆ·èƒ½è®¿é—®æ—¥å¿—è·¯å¾„
æ²¡æœ‰ .summary æ–‡ä»¶æ—¶æŠ¥é”™	åŠ  `
å¤š job ä¹‹é—´å…±äº«å˜é‡	å¯å†™åˆ° artifacts:reports ä¸­æˆ–ç”¨ cache å…±äº«æ–‡ä»¶



---

è¦ä¸è¦æˆ‘æŠŠè¿™ä¸ª scp + artifact æ•´åˆåˆ°ä½ å·²æœ‰çš„ run_and_monitor.sh ç»“å°¾ï¼Œè‡ªåŠ¨æ”¶é›†æ—¥å¿—ï¼Ÿè¿™æ ·å°±å¯ä»¥åªç”¨ä¸€ä¸ªè„šæœ¬+ä¸€ä¸ª jobã€‚ä½ æ„¿æ„è´´ä¸‹ç°æœ‰ .gitlab-ci.yml å—ï¼Ÿ

