è¿™ä¸ªæƒ…å†µå¾ˆå¸¸è§ï¼Œè€Œä¸”ä¸æ˜¯ä½ å‘½ä»¤å†™é”™ ğŸ‘
ç»“è®ºå…ˆç»™ä½ ï¼š
AvailabilityZoneId è¿”å› Noneï¼Œé€šå¸¸æ˜¯å› ä¸ºä½ ç”¨çš„ AWS CLI / API ç‰ˆæœ¬è¾ƒè€ï¼Œæˆ–è€…è¯¥å­—æ®µåœ¨ä½ å½“å‰è¿”å›é‡Œä¸å­˜åœ¨ã€‚
æˆ‘ä¸€æ­¥ä¸€æ­¥å¸®ä½ å®šä½ã€‚
ä¸€ã€ä¸ºä»€ä¹ˆä¼šæ˜¯ None
1ï¸âƒ£ AvailabilityZoneId æ˜¯ åæ¥æ‰åŠ çš„å­—æ®µ
è€ç‰ˆæœ¬ AWS CLI / botocoreï¼š
Placement.AvailabilityZone âœ…
Placement.AvailabilityZoneId âŒï¼ˆè¿”å› null / noneï¼‰
ğŸ‘‰ æ‰€ä»¥ å­—æ®µå­˜åœ¨äºæ–‡æ¡£ï¼Œä¸ä»£è¡¨ä½ å½“å‰ CLI çœŸæ”¯æŒ
äºŒã€å…ˆç¡®è®¤ï¼šæ˜¯ä¸æ˜¯ CLI ç‰ˆæœ¬é—®é¢˜ï¼ˆ90% çš„åŸå› ï¼‰
æŸ¥çœ‹ç‰ˆæœ¬
å¤åˆ¶ä»£ç 
Bash
aws --version
å¦‚æœä½ çœ‹åˆ°ç±»ä¼¼ï¼š
å¤åˆ¶ä»£ç 

aws-cli/1.xx.xx
ğŸ‘‰ AWS CLI v1 åŸºæœ¬éƒ½ä¼šæ‹¿ä¸åˆ° AvailabilityZoneId
âœ… æ­£ç¡®å§¿åŠ¿
è¯·ç¡®ä¿æ˜¯ AWS CLI v2
å¤åˆ¶ä»£ç 

aws-cli/2.x.x
å¦‚æœä½ åœ¨å…¬å¸æœåŠ¡å™¨ / CI / container é‡Œè·‘ï¼ŒåŸºæœ¬åæœ‰å…«ä¹æ˜¯ v1
ä¸‰ã€å³ä½¿ CLI è€ï¼Œä¹Ÿæœ‰ã€Œç¨³å®šå¯ç”¨ã€çš„æ›¿ä»£æ–¹æ¡ˆï¼ˆæ¨èï¼‰
ğŸ‘‰ ä¸è¦ä» instance æ‹¿ AZ ID ğŸ‘‰ ä» AZ æ˜ å°„è¡¨æ‹¿ï¼ˆæœ€ç¨³ã€æœ€é€šç”¨ï¼‰
âœ… æ­£ç¡® & é€šåƒå†™æ³•
å¤åˆ¶ä»£ç 
Bash
aws ec2 describe-availability-zones \
  --region ap-southeast-2 \
  --query 'AvailabilityZones[].{AZ:ZoneName, AZId:ZoneId}'
  --output table
è¿™ä¸ªå‘½ä»¤ï¼š
ä¸ä¾èµ–å®ä¾‹
CLI v1 / v2 éƒ½èƒ½ç”¨
ä¸€å®šæœ‰ ZoneId
å››ã€æŠŠ EC2 / EKS Node çš„ AZ æ˜ å°„æˆ AZ IDï¼ˆå®æˆ˜å†™æ³•ï¼‰
Step 1ï¼šæ‹¿ Node çš„ AZï¼ˆK8s å±‚ï¼‰
å¤åˆ¶ä»£ç 
Bash
kubectl get node <node-name> \
  -o jsonpath='{.metadata.labels.topology\.kubernetes\.io/zone}'
è¾“å‡ºï¼š
å¤åˆ¶ä»£ç 

ap-southeast-2b
Step 2ï¼šç”¨ AZ â†’ AZ ID æ˜ å°„
å¤åˆ¶ä»£ç 
Bash
AZ=ap-southeast-2b

aws ec2 describe-availability-zones \
  --region ap-southeast-2 \
  --query "AvailabilityZones[?ZoneName=='$AZ'].ZoneId" \
  --output text
è¾“å‡ºï¼š
å¤åˆ¶ä»£ç 

apse2-az1
âœ… è¿™æ‰æ˜¯ç”Ÿäº§é‡Œæœ€ç¨³çš„æ–¹å¼
äº”ã€å¦‚æœä½ ä¸€å®šè¦ç”¨ instance æŸ¥ï¼ˆä¸æ¨èï¼‰
åªæœ‰åœ¨ AWS CLI v2 + æ–° botocore æ‰è¡Œï¼š
å¤åˆ¶ä»£ç 
Bash
aws ec2 describe-instances \
  --instance-ids i-xxxx \
  --query 'Reservations[].Instances[].Placement'
ä½ å¦‚æœçœ‹åˆ°è¾“å‡ºé‡Œ æ ¹æœ¬æ²¡æœ‰ AvailabilityZoneId å­—æ®µ
ğŸ‘‰ é‚£å°± 100% æ˜¯ CLI ç‰ˆæœ¬é—®é¢˜ï¼Œä¸æ˜¯ä½ æ“ä½œé—®é¢˜
å…­ã€æˆ‘ç»™ä½ ä¸€å¥è¿ç»´ç»“è®ºï¼ˆå¾ˆé‡è¦ï¼‰
âŒ ä¸è¦æŒ‡æœ›ä» EC2 / Node ç›´æ¥æ‹¿ apse2-az1
âœ… æ°¸è¿œç”¨ describe-availability-zones åšæ˜ å°„
AWS å®˜æ–¹ä¹Ÿæ˜¯è¿™ä¹ˆå»ºè®®çš„ï¼Œå¾ˆå¤šè·¨è´¦å·äº‹æ•…å°±æ˜¯æ²¡è¿™ä¹ˆå¹²ã€‚
å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ç›´æ¥å¸®ä½ å†™ä¸€æ®µ å®Œæ•´ bashï¼š
è¾“å…¥ï¼šEKS node name
è¾“å‡ºï¼š
å¤åˆ¶ä»£ç 

node-name  ap-southeast-2b  apse2-az1
ä½ åªè¦è¯´ä¸€å¥ï¼š
