ä¸‹é¢ç»™ä½ å¯ç›´æ¥å¯¼å…¥ FIS Console çš„ç¤ºä¾‹æ¨¡æ¿ï¼ˆæ–¹æ³• 3ï¼šå¯¹ä¸»å®ä¾‹æ‰€åœ¨ AZ åšå…¨é‡ç½‘ç»œéš”ç¦»ï¼‰ã€‚
ğŸ‘‰ ä½ åªéœ€è¦æ›¿æ¢ä¸‰å¤„å ä½ç¬¦å³å¯è¿è¡Œï¼š
<ACCOUNT_ID>
<REGION>
<PRIMARY_AZ_ID>ï¼ˆä¾‹å¦‚ï¼šapse2-az1ï¼‰
âœ… FIS æ¨¡æ¿ï¼ˆå®Œæ•´ JSONï¼‰
å¤åˆ¶ä»£ç 
Json
{
  "description": "Disrupt all network connectivity in primary AZ to trigger RDS Multi-AZ failover",
  "targets": {
    "PrimaryAZ": {
      "resourceType": "aws:ec2:availability-zone",
      "resourceArns": [
        "arn:aws:ec2:<REGION>:<ACCOUNT_ID>:availability-zone/<PRIMARY_AZ_ID>"
      ],
      "selectionMode": "ALL"
    }
  },
  "actions": {
    "DisruptAZNetwork": {
      "actionId": "aws:ec2:network-disrupt-connectivity",
      "parameters": {
        "scope": "ALL",
        "duration": "PT120S"
      },
      "targets": {
        "AvailabilityZones": "PrimaryAZ"
      }
    }
  },
  "stopConditions": [
    {
      "source": "aws:cloudwatch:alarm",
      "value": "arn:aws:cloudwatch:<REGION>:<ACCOUNT_ID>:alarm/Your-Alarm-Name"
    }
  ],
  "roleArn": "arn:aws:iam::<ACCOUNT_ID>:role/Your-FIS-Role",
  "tags": {
    "Name": "rds-az-failover-chaos-test"
  }
}
ğŸ‘‰ ä½ éœ€è¦æ›¿æ¢çš„åœ°æ–¹ï¼ˆå¿…æ”¹ï¼‰
1ï¸âƒ£ AZï¼ˆæœ€å…³é”®ï¼‰
æŠŠè¿™ä¸€è¡Œæ”¹æˆä½  Primary æ‰€åœ¨ AZï¼š
å¤åˆ¶ä»£ç 
Json
"arn:aws:ec2:<REGION>:<ACCOUNT_ID>:availability-zone/<PRIMARY_AZ_ID>"
ä¾‹å¦‚ï¼š
å¤åˆ¶ä»£ç 
Json
"arn:aws:ec2:ap-southeast-2:123456789012:availability-zone/apse2-az1"
2ï¸âƒ£ FIS Roleï¼ˆå¿…éœ€ï¼‰
æŠŠè¿™ä¸€è¡Œæ¢æˆä½ è‡ªå·±çš„ FIS å®éªŒè§’è‰²ï¼š
å¤åˆ¶ä»£ç 
Json
"roleArn": "arn:aws:iam::<ACCOUNT_ID>:role/Your-FIS-Role"
è¯¥è§’è‰²å¿…é¡»åŒ…å«ï¼ˆæœ€å°æƒé™ç¤ºä¾‹ï¼‰ï¼š
å¤åˆ¶ä»£ç 
Json
{
  "Effect": "Allow",
  "Action": [
    "ec2:StartNetworkInsightsAccessScopeAnalysis",
    "ec2:CreateTrafficMirrorFilter",
    "ec2:CreateTrafficMirrorFilterRule",
    "ec2:DeleteTrafficMirrorFilter",
    "ec2:DeleteTrafficMirrorFilterRule"
  ],
  "Resource": "*"
}
ä»¥åŠï¼š
å¤åˆ¶ä»£ç 
Json
{
  "Effect": "Allow",
  "Action": "fis:InjectApiInternalError",
  "Resource": "*"
}
3ï¸âƒ£ CloudWatch Alarmï¼ˆå¯é€‰ï¼‰
å¦‚æœä½ æ²¡æœ‰ stopConditionï¼Œå¯ä»¥æŠŠæ•´ä¸ª stopConditions åˆ æ‰ï¼›
æˆ–è€…æ”¹æˆä½ è‡ªå·±çš„å‘Šè­¦ ARNã€‚
ä½ è¿è¡Œåä¼šçœ‹åˆ°ä»€ä¹ˆï¼ˆéªŒè¯ç‚¹ï¼‰
å¦‚æœæ˜¯ Multi-AZ RDSï¼š
30â€“120s å†…å¤§æ¦‚ç‡å‘ç”Ÿ failover
æ–° Primary ä¼šå˜åˆ°å¦ä¸€ AZ
åŸ AZ æ¢å¤åä¼šå˜æˆ Standby
ä½ å¯ä»¥åœ¨ RDS æ§åˆ¶å°çœ‹ï¼š
Writer AZ å‘ç”Ÿå˜åŒ– âœ…
Failover time é€šå¸¸ 10â€“60s
å¦‚æœä½ å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¯ä»¥å¸®ä½ â€œå®šåˆ¶ç‰ˆâ€
å‘Šè¯‰æˆ‘ï¼š
1ï¸âƒ£ ä½ çš„ Regionï¼ˆä¾‹å¦‚ ap-southeast-2ï¼‰
2ï¸âƒ£ Primary å½“å‰ AZï¼ˆapse2-az1/az2/az3ï¼‰
3ï¸âƒ£ Aurora è¿˜æ˜¯æ™®é€š RDS Multi-AZ
æˆ‘å¯ä»¥å¸®ä½ æŠŠæœ€ç»ˆå¯ç›´æ¥ç²˜è´´çš„ JSONå¡«å¥½å‘ç»™ä½ ã€‚