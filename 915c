ğŸ‘Œ æƒ³è¦åœ¨ è‡ªå·± AWS è´¦å·é‡ŒåŠ¨æ‰‹è¯• Database Insightsï¼ˆTop SQL ç­‰ï¼‰ï¼Œåˆæƒ³ä¿æŒ æœ€ä½è´¹ç”¨ï¼Œå¯ä»¥æŒ‰è¿™ä¸ªæ€è·¯æ¥æ“ä½œï¼š


---

ğŸ”¹ 1. å‡†å¤‡æœ€å°æˆæœ¬çš„ RDS å®ä¾‹

1. Regionï¼šé€‰æ‹©æ”¯æŒ Database Insights çš„ Regionï¼ˆå¸¸è§çš„ ap-southeast-2ã€us-east-1 éƒ½æœ‰ï¼‰ã€‚


2. DB å¼•æ“ï¼šPostgreSQL æˆ– MySQLï¼ˆAurora ä¹Ÿå¯ä»¥ï¼‰ã€‚


3. å®ä¾‹è§„æ ¼ï¼šé€‰ db.t3.microï¼ˆæ”¯æŒ Free tier çš„è¯æ›´çœï¼‰ã€‚

å¦‚æœä½ è´¦å·è¿˜åœ¨ Free Tierï¼ˆ12 ä¸ªæœˆï¼‰ï¼ŒRDS t3.micro æ¯æœˆ 750 å°æ—¶æ˜¯å…è´¹çš„ã€‚

å³ä½¿è¿‡äº† Free Tierï¼Œt3.micro åœ¨ Sydney åŒºä¹Ÿå°± ~$15/æœˆï¼Œæµ‹è¯•è·‘å‡ å¤©åªè¦å‡ å—é’±ã€‚



4. å­˜å‚¨ï¼šæœ€å° 20GB gp3ï¼Œå‡ æ¯›é’±ä¸€å¤©ã€‚



> âš ï¸ æ³¨æ„ï¼šDatabase Insights æ˜¯ å…è´¹å¼€å¯çš„ï¼ˆåŸºç¡€ 7 å¤©å†å²ï¼‰ï¼Œåªæœ‰ **Extended retentionï¼ˆé•¿æœŸå†å²å­˜å‚¨ï¼‰**æ‰æ”¶è´¹ï¼Œæ‰€ä»¥æµ‹è¯•å®Œå…¨ä¸èŠ±é¢å¤–çš„é’±ã€‚




---

ğŸ”¹ 2. å¯ç”¨ Database Insights

åœ¨åˆ›å»º RDS å®ä¾‹æ—¶ï¼š

å¯ç”¨ Performance Insights / Database Insightsï¼Œä¿ç•™ 7 å¤©ï¼ˆå…è´¹ï¼‰ã€‚

å¦‚æœå¿˜äº†å‹¾ï¼Œå¯ä»¥åœ¨å®ä¾‹ Modify â†’ Monitoring â†’ Enable Performance Insightsã€‚



---

ğŸ”¹ 3. ç”Ÿæˆç‚¹ SQL è´Ÿè½½ï¼ˆè¦æœ‰ Top SQL æ‰èƒ½çœ‹ï¼‰

é»˜è®¤æ–°åº“æ²¡å•¥ SQL è¯­å¥ï¼Œæ‰€ä»¥ä½ è¦é€ ç‚¹æŸ¥è¯¢ï¼š

æ¯”å¦‚ç”¨ psql è¿è¿›å»ï¼Œæ‰§è¡Œä¸€äº›è¯­å¥ï¼š

CREATE TABLE t(id serial primary key, data text);
INSERT INTO t(data) SELECT md5(random()::text) FROM generate_series(1,100000);

-- æ¨¡æ‹Ÿæ…¢æŸ¥è¯¢
SELECT count(*) FROM t, generate_series(1,1000);

è¿™æ · Database Insights å°±èƒ½æ•æ‰åˆ° SQL å’Œè´Ÿè½½ã€‚


---

ğŸ”¹ 4. åœ¨æ§åˆ¶å°æŸ¥çœ‹ Database Insights

1. æ‰“å¼€ RDS â†’ Database Insights â†’ [é€‰æ‹©å®ä¾‹]


2. é»˜è®¤ä¼šçœ‹åˆ° Database load å›¾


3. ç‚¹å‡» Top SQLã€Top waits å°±èƒ½çœ‹åˆ°ç»†åˆ†æŒ‡æ ‡




---

ğŸ”¹ 5. å¯¼å‡ºåˆ° CloudWatch Dashboard

1. åœ¨ Database Insights é¡µé¢ â†’ Metrics åŒºåŸŸ


2. æ‰¾åˆ° Export to CloudWatch Dashboard / Add to dashboard


3. é€‰ æ–°å»ºä¸€ä¸ª dashboard


4. å¯¼å‡ºåï¼Œå» CloudWatch â†’ Dashboards å°±èƒ½çœ‹åˆ° widget




---

ğŸ”¹ 6. IAM æƒé™ï¼ˆæœ€å°åŒ–ï¼‰

å¦‚æœä½ æ˜¯ root è´¦å·ç›´æ¥è¯•ï¼Œä¸ç”¨ç®¡ã€‚
å¦‚æœæ˜¯ IAM user/roleï¼Œéœ€è¦åŠ ï¼š

{
  "Effect": "Allow",
  "Action": [
    "pi:GetResourceMetrics",
    "pi:DescribeDimensionKeys",
    "pi:GetDimensionKeyDetails",
    "rds:DescribeDBInstances",
    "cloudwatch:PutDashboard",
    "cloudwatch:GetDashboard",
    "cloudwatch:ListDashboards"
  ],
  "Resource": "*"
}


---

ğŸ”¹ 7. æˆæœ¬æ§åˆ¶

RDS t3.microï¼šæŒ‰å°æ—¶è®¡è´¹ï¼Œå¼€ä¸€ä¸¤å¤©ä¸ä¼šè¶…è¿‡ $1ã€‚

Database Insightsï¼šåŸºç¡€åŠŸèƒ½ï¼ˆ7 å¤©ä¿ç•™ï¼‰å…è´¹ã€‚

CloudWatch Dashboardï¼šå‰ 3 ä¸ª dashboard å…è´¹ï¼›è¶…è¿‡æŒ‰ $3/æœˆè®¡è´¹ã€‚


ğŸ‘‰ æ‰€ä»¥å®Œå…¨å¯ä»¥ç”¨ t3.micro + 7 å¤© Database Insights + å…è´¹ CloudWatch dashboardï¼Œè·‘ä¸¤å¤©åŸºæœ¬èŠ±ä¸åˆ° $1ã€‚


---

âš¡æ€»ç»“ï¼š
æœ€ä½è´¹ç”¨å®éªŒæ­¥éª¤ï¼š

1. å»ºä¸€ä¸ª db.t3.microï¼ˆPostgres/MySQLï¼‰ï¼Œå¯ç”¨ Database Insightsï¼ˆ7 å¤©å…è´¹ï¼‰ã€‚


2. æ’å…¥æµ‹è¯•æ•°æ®ï¼Œè·‘ç‚¹ SQLã€‚


3. æ‰“å¼€ Database Insights â†’ å¯¼å‡ºåˆ° CloudWatch Dashboardã€‚


4. æŸ¥çœ‹å¤§ç›˜é‡Œçš„ Top SQL / Top waits widgetã€‚




---

è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ª ä¸€é”® CloudFormation æ¨¡æ¿ï¼Œç›´æ¥éƒ¨ç½²ä¸€ä¸ª t3.micro + Database Insights å¼€å¯çš„æµ‹è¯•æ•°æ®åº“ï¼ˆå‡ åˆ†é’Ÿå°±èƒ½è·‘èµ·æ¥ï¼‰ï¼Ÿ

