å¾ˆå¥½çš„é—®é¢˜ ğŸ‘ã€‚ä½ æƒ³æŠŠ Database Insightsï¼ˆå…¶å®åº•å±‚æ˜¯ DevOps Guru for RDS èšåˆ Performance Insights çš„ SQL Metricsï¼‰çš„æ•°æ®æ”¾åˆ°ä½ è‡ªå·±çš„å¤§ç›˜é‡Œï¼ˆæ¯”å¦‚ CloudWatch Dashboardã€Grafanaã€QuickSightï¼‰ï¼Œæ€è·¯å¤§æ¦‚æœ‰ä¸‰æ¡ï¼š


---

1. ç”¨ CloudWatch Embedded Metrics

Database Insights çš„ Top SQL Metrics åº•å±‚è¿˜æ˜¯æ¥è‡ª Performance Insights APIã€‚

ä½ å¯ä»¥é€šè¿‡ rds:DescribeDimensionKeys å’Œ rds:GetResourceMetrics API æ‹‰å–åˆ° Top SQLã€‚

ä¾‹å¦‚ï¼š

aws rds describe-dimension-keys \
  --service-type RDS \
  --identifier db-XYZ \
  --start-time 2025-08-27T00:00:00Z \
  --end-time 2025-08-27T01:00:00Z \
  --metric DBLoad \
  --group-by Dimension=sql

è¿™ä¼šè¿”å›æŸæ—¶é—´æ®µçš„ Top SQLï¼ˆæŒ‰ AAS æ’åºï¼‰ã€‚


æŠŠè¿™äº›æŒ‡æ ‡å†™å…¥ CloudWatch Custom Metricsï¼ˆæ¯”å¦‚å‘½åç©ºé—´ï¼šCustom/DatabaseSQLï¼‰ï¼Œå°±èƒ½åœ¨ CloudWatch Dashboard æˆ– Grafana é‡Œå±•ç¤ºã€‚



---

2. ç›´æ¥ç”¨ Performance Insights API

GetResourceMetrics API å¯ä»¥æ‹‰å–ä½ æƒ³è¦çš„ SQL çº§åˆ«æŒ‡æ ‡ï¼ˆCPU time, AAS, executionsï¼‰ã€‚

DescribeDimensionKeys å¯ä»¥è·å– Top SQL IDï¼ˆsql hashï¼‰ã€‚

ç„¶åå†é…åˆ GetDimensionKeyDetails è·å– SQL æ–‡æœ¬ã€‚

ä½ å¯ä»¥ç”¨ Lambda å®šæ—¶ä»»åŠ¡ï¼ˆæ¯ 1 åˆ†é’Ÿ/5 åˆ†é’Ÿï¼‰æ‹‰è¿™äº›æ•°æ®ï¼Œå­˜åˆ°ï¼š

CloudWatch metricsï¼ˆå®æ—¶ç›‘æ§ï¼‰

Prometheus / Grafanaï¼ˆé€šè¿‡ exporterï¼‰

S3 + Athena/QuickSightï¼ˆåšå†å²åˆ†ææŠ¥è¡¨ï¼‰




---

3. é€šè¿‡ DevOps Guru for RDS Insights Events

å¦‚æœä½ æƒ³ç›´æ¥ç”¨ Database Insights çš„ç»“æœï¼ˆè€Œä¸æ˜¯è‡ªå·±é‡ç®— Top SQLï¼‰ï¼š

DevOps Guru ä¼šæŠŠå¼‚å¸¸æ£€æµ‹å’Œ Top SQL æŠ¥å‘Šä½œä¸º Insight Event å‘åˆ° EventBridgeã€‚

ä½ å¯ä»¥è®¢é˜… EventBridgeï¼ŒæŠŠäº‹ä»¶å†…å®¹ï¼ˆåŒ…å« top sql ä¿¡æ¯ï¼‰è½¬å‘åˆ° CloudWatch Logsã€S3ã€æˆ–è‡ªå»ºå¤§ç›˜ã€‚

ä¸è¿‡è¿™ç§æ–¹å¼æ›´å¤šæ˜¯ å‘Šè­¦å’Œæ‘˜è¦ï¼Œç²’åº¦ä¸å¦‚ç›´æ¥æ‹‰ Performance Insights APIã€‚




---

æ¨èæ–¹æ¡ˆ

å¦‚æœä½ è¦åš å®æ—¶å¤§ç›˜ï¼ˆGrafana/CloudWatchï¼‰ï¼šèµ° Performance Insights API + CloudWatch Custom Metricsã€‚

å¦‚æœä½ è¦åš å†å²æŠ¥è¡¨ï¼ˆQuickSight/BIï¼‰ï¼šèµ° API â†’ S3 â†’ Athena/QuickSightã€‚

å¦‚æœä½ åªè¦ å¼‚å¸¸äº‹ä»¶ï¼šèµ° DevOps Guru + EventBridgeã€‚



---

è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ª Lambda ç¤ºä¾‹ä»£ç ï¼ˆPythonï¼‰ï¼Œå®šæ—¶æ‹‰å– Top SQLï¼ˆAAS æ’åºï¼‰å¹¶æ¨é€åˆ° CloudWatch Metricsï¼Œè¿™æ ·ä½ å°±èƒ½ç›´æ¥åœ¨è‡ªå·±çš„å¤§ç›˜é‡Œç”»å‡ºæ¥ï¼Ÿ

