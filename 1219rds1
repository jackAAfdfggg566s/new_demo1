è¿™ä¸ªå°±æ˜¯ Aurora é›†ç¾¤ åœºæ™¯äº† ğŸ‘
ç›®æ ‡ï¼š1 ä¸ª writer + 2 ä¸ª readerï¼Œåˆ†åˆ«è¾“å‡ºå„è‡ªçš„ AZ

ä¸‹é¢ç»™ä½  æœ€å®ç”¨ã€å¯ç›´æ¥ç”¨åœ¨è„šæœ¬é‡Œçš„å‡ ç§æ–¹å¼ã€‚


---

ä¸€ã€ä¸€æ¬¡æ€§åˆ—å‡º Writer / Reader + AZï¼ˆæœ€æ¨è âœ…ï¼‰

aws rds describe-db-instances \
  --query 'DBInstances[?DBClusterIdentifier==`my-aurora-cluster`].[DBInstanceIdentifier,DBInstanceRole,AvailabilityZone]' \
  --output table

è¾“å‡ºç¤ºä¾‹ï¼š

------------------------------------------------------
|            DescribeDBInstances                     |
+----------------------+---------+------------------+
| aurora-db-writer-1  | WRITER  | ap-southeast-2a |
| aurora-db-reader-1  | READER  | ap-southeast-2b |
| aurora-db-reader-2  | READER  | ap-southeast-2c |
+----------------------+---------+------------------+

> âœ” Aurora çœŸæ­£åŒºåˆ† writer / reader çš„å­—æ®µæ˜¯ DBInstanceRole




---

äºŒã€è„šæœ¬é‡Œåˆ†åˆ«æ‹¿ Writer / Reader çš„ AZï¼ˆè‡ªåŠ¨åŒ–å¸¸ç”¨ï¼‰

1ï¸âƒ£ Writer AZ

WRITER_AZ=$(aws rds describe-db-instances \
  --query 'DBInstances[?DBClusterIdentifier==`my-aurora-cluster` && DBInstanceRole==`WRITER`].AvailabilityZone' \
  --output text)

echo "Writer AZ: $WRITER_AZ"


---

2ï¸âƒ£ Reader AZï¼ˆ2 ä¸ªï¼Œä¼šè¿”å› 2 è¡Œï¼‰

READER_AZS=$(aws rds describe-db-instances \
  --query 'DBInstances[?DBClusterIdentifier==`my-aurora-cluster` && DBInstanceRole==`READER`].AvailabilityZone' \
  --output text)

echo "Reader AZs: $READER_AZS"

è¾“å‡ºï¼š

Reader AZs: ap-southeast-2b ap-southeast-2c


---

ä¸‰ã€åˆ†åˆ«è¾“å‡ºï¼ˆwriter / reader1 / reader2ï¼‰

å¦‚æœä½ æ˜ç¡®çŸ¥é“æœ‰ 2 ä¸ª readerï¼š

read WRITER_AZ <<< $(aws rds describe-db-instances \
  --query 'DBInstances[?DBClusterIdentifier==`my-aurora-cluster` && DBInstanceRole==`WRITER`].AvailabilityZone' \
  --output text)

read READER1_AZ READER2_AZ <<< $(aws rds describe-db-instances \
  --query 'DBInstances[?DBClusterIdentifier==`my-aurora-cluster` && DBInstanceRole==`READER`].AvailabilityZone' \
  --output text)

echo "Writer  AZ : $WRITER_AZ"
echo "Reader1 AZ : $READER1_AZ"
echo "Reader2 AZ : $READER2_AZ"


---

å››ã€å¸¦å®ä¾‹åä¸€èµ·è¾“å‡ºï¼ˆæœ€æ¸…æ™°ï¼Œé€‚åˆæ—¥å¿—ï¼‰

aws rds describe-db-instances \
  --query 'DBInstances[?DBClusterIdentifier==`my-aurora-cluster`].{Instance:DBInstanceIdentifier,Role:DBInstanceRole,AZ:AvailabilityZone}' \
  --output json


---

äº”ã€å¸¸è§å‘æé†’ âš ï¸

1. Aurora æ²¡æœ‰ SecondaryAvailabilityZone


2. Writer / Reader éš failover ä¼šå˜


3. ä¸€å®šç”¨ DBInstanceRoleï¼Œä¸è¦é åå­—çŒœ




---

å…­ã€ä½ è¿™ä¸ªéœ€æ±‚ä¸‹ä¸€æ­¥é€šå¸¸æ˜¯ ğŸ‘‡

æˆ‘çŒœä½ åé¢å¯èƒ½è¦ï¼š

â“ åˆ¤æ–­ writer æ˜¯å¦åœ¨ 2a

â“ é¿å… EKS Pod è·Ÿ writer åŒ AZ

â“ failover å‰å å¯¹æ¯” AZ æ˜¯å¦å˜åŒ–

â“ æ ¹æ® AZ æ‰¾ subnet / nodegroup


ä½ ç›´æ¥è¯´ä¸€å¥
ğŸ‘‰ã€Œæˆ‘è¦æ‹¿ writer / reader AZ å»åšä»€ä¹ˆã€
æˆ‘å¸®ä½ æŠŠ å®Œæ•´è„šæœ¬ + åˆ¤æ–­é€»è¾‘ ä¸€æ¬¡å†™å¥½ã€‚