ä¸‹é¢æˆ‘æŒ‰ä½ è¦æ±‚åˆ†æˆä¸¤ç§åœºæ™¯æ¥è¯´æ˜ï¼š
åœºæ™¯ Aï¼šåº”ç”¨ç›´æ¥è·‘åœ¨ EC2ï¼ˆASGï¼‰ä¸Š
åœºæ™¯ Bï¼šåº”ç”¨è·‘åœ¨ EKSï¼ˆNode Groupï¼‰ä¸Š
æ¯ä¸ªåœºæ™¯éƒ½ç»™ä½ ï¼š
ğŸ‘‰ æµ‹è¯•ç›®æ ‡ï¼ˆAZ failover è§†è§’ï¼‰
ğŸ‘‰ FIS å®éªŒæ¨¡æ¿ï¼ˆå¯ç›´æ¥æ”¹ç”¨ï¼‰
ğŸ‘‰ æµ‹è¯•æ­¥éª¤
ğŸ‘‰ é¢„æœŸç»“æœï¼ˆå¿…é¡» / ç†æƒ³ / å¤±è´¥ä¿¡å·ï¼‰
ä½ å¯ä»¥ç›´æ¥æ‹¿å»åš Chaos / DR / Resilience æµ‹è¯•æ–‡æ¡£ã€‚
åœºæ™¯ Aï¼šåº”ç”¨è¿è¡Œåœ¨ EC2ï¼ˆASGï¼‰
1ï¸âƒ£ æµ‹è¯•ç›®æ ‡ï¼ˆä½ åœ¨â€œæ¨¡æ‹Ÿä»€ä¹ˆâ€ï¼‰
Simulate Availability Zoneâ€“level capacity loss for EC2-based applications.
å…·ä½“ç­‰ä»·äºï¼š
æŸä¸€ä¸ª AZ ä¸­çš„ EC2 å…¨éƒ¨ä¸å¯ç”¨
æ–°å®ä¾‹ æ— æ³•åœ¨è¯¥ AZ å¯åŠ¨
éªŒè¯ ASG æ˜¯å¦ è‡ªåŠ¨ fail over åˆ°å…¶ä»– AZ
2ï¸âƒ£ FIS å®éªŒæ¨¡æ¿ï¼ˆEC2 / ASGï¼‰
ğŸ¯ æ€è·¯
åªæ€ä¸€ä¸ª AZ
å¼ºåˆ¶ ASG è§¦å‘ scale out
FIS Templateï¼ˆJSON ç¤ºä¾‹ï¼‰
å¤åˆ¶ä»£ç 
Json
{
  "description": "Simulate AZ failure for EC2 ASG",
  "targets": {
    "AzAInstances": {
      "resourceType": "aws:ec2:instance",
      "resourceTags": {
        "aws:autoscaling:groupName": "my-asg"
      },
      "filters": [
        {
          "path": "Placement.AvailabilityZone",
          "values": ["ap-southeast-2a"]
        }
      ],
      "selectionMode": "ALL"
    }
  },
  "actions": {
    "TerminateInstances": {
      "actionId": "aws:ec2:terminate-instances",
      "parameters": {},
      "targets": {
        "Instances": "AzAInstances"
      }
    }
  },
  "stopConditions": [
    {
      "source": "none"
    }
  ]
}
âš ï¸ å¼ºçƒˆå»ºè®®ï¼š
ASG é…ç½® è‡³å°‘ 2 ä¸ª AZ
HealthCheckType = EC2 or ELB
CapacityRebalance = true
3ï¸âƒ£ æµ‹è¯•æ­¥éª¤ï¼ˆEC2ï¼‰
ç¡®è®¤ ASG å®ä¾‹åˆ†å¸ƒåœ¨å¤šä¸ª AZ
å¯åŠ¨ FISï¼š
ç»ˆæ­¢ æŸä¸€ä¸ª AZ çš„æ‰€æœ‰å®ä¾‹
åŒæ—¶æˆ–ä¹‹åï¼š
æé«˜ ASG DesiredCapacity
æˆ–
åˆ¶é€  CPU / è¯·æ±‚å‹åŠ›
4ï¸âƒ£ é¢„æœŸç»“æœï¼ˆEC2ï¼‰
âœ… å¿…é¡»çœ‹åˆ°ï¼ˆPassï¼‰
ASG Eventsï¼š
å¤åˆ¶ä»£ç 

Launching instance in ap-southeast-2b
æ–°å®ä¾‹ ä¸å†å‡ºç°åœ¨æ•…éšœ AZ
ELB / ALB Target æ¢å¤ Healthy
ğŸŸ¡ ç†æƒ³çŠ¶æ€ï¼ˆExcellentï¼‰
ASGï¼š
è‡ªåŠ¨è·¨ AZ è¡¥é½å®¹é‡
æ— äººå·¥å¹²é¢„
åº”ç”¨ï¼š
è¯·æ±‚æˆåŠŸç‡è½»å¾®æ³¢åŠ¨
æ— é•¿æ—¶é—´ 5xx
âŒ å¤±è´¥ä¿¡å·ï¼ˆFailï¼‰
ASG ä¸€ç›´å°è¯•åœ¨ åŒä¸€ä¸ª AZ
ASG Events å‡ºç°å¾ªç¯ï¼š
å¤åˆ¶ä»£ç 

InsufficientInstanceCapacity
åº”ç”¨å®¹é‡é•¿æœŸä¸è¶³
æ— å‘Šè­¦è§¦å‘
åœºæ™¯ Bï¼šåº”ç”¨è¿è¡Œåœ¨ EKSï¼ˆNode Groupï¼‰
1ï¸âƒ£ æµ‹è¯•ç›®æ ‡ï¼ˆä½ åœ¨â€œæ¨¡æ‹Ÿä»€ä¹ˆâ€ï¼‰
Simulate Availability Zone failure affecting Kubernetes node provisioning.
ç­‰ä»·äºï¼š
æŸ AZï¼š
Node è¢«å¤§é‡ç»ˆæ­¢
æ–° Node æ— æ³•åŠ å…¥é›†ç¾¤
éªŒè¯ï¼š
NodeGroup / ASG æ˜¯å¦è·¨ AZ
Pod æ˜¯å¦è‡ªåŠ¨è¿ç§»
2ï¸âƒ£ FIS å®éªŒæ¨¡æ¿ï¼ˆEKS Nodeï¼‰
ğŸ¯ æ€è·¯
ç›´æ¥æ€ EKS Nodeï¼ˆEC2ï¼‰
AZ çº§åˆ«
FIS Templateï¼ˆJSON ç¤ºä¾‹ï¼‰
å¤åˆ¶ä»£ç 
Json
{
  "description": "Simulate AZ failure for EKS node group",
  "targets": {
    "EksNodesAzA": {
      "resourceType": "aws:ec2:instance",
      "resourceTags": {
        "eks:nodegroup-name": "my-node-group"
      },
      "filters": [
        {
          "path": "Placement.AvailabilityZone",
          "values": ["ap-southeast-2a"]
        }
      ],
      "selectionMode": "ALL"
    }
  },
  "actions": {
    "TerminateEksNodes": {
      "actionId": "aws:ec2:terminate-instances",
      "parameters": {},
      "targets": {
        "Instances": "EksNodesAzA"
      }
    }
  },
  "stopConditions": [
    {
      "source": "none"
    }
  ]
}
3ï¸âƒ£ æµ‹è¯•æ­¥éª¤ï¼ˆEKSï¼‰
ç¡®è®¤ï¼š
NodeGroup è¦†ç›– â‰¥ 2 ä¸ª AZ
Deployment æœ‰å¤šä¸ª replica
å¯åŠ¨ FISï¼š
æ€æ‰ä¸€ä¸ª AZ çš„ Node
è§¦å‘è°ƒåº¦ï¼š
Pod è¢« evict
HPA scale outï¼ˆå¯é€‰ï¼‰
4ï¸âƒ£ é¢„æœŸç»“æœï¼ˆEKSï¼‰
âœ… å¿…é¡»çœ‹åˆ°ï¼ˆPassï¼‰
kubectl get nodes
å…¶ä»– AZ Node æ•°é‡ä¸Šå‡
kubectl get pods
Pod ä» Pending â†’ Running
NodeGroup è‡ªåŠ¨è¡¥é½ capacity
ğŸŸ¡ ç†æƒ³çŠ¶æ€ï¼ˆExcellentï¼‰
PodDisruptionBudget ç”Ÿæ•ˆ
è¯·æ±‚å»¶è¿Ÿå¯æ§
æ— å¤§è§„æ¨¡é‡å¯é£æš´
âŒ å¤±è´¥ä¿¡å·ï¼ˆFailï¼‰
Pod é•¿æœŸ Pending
æ–° Node åªå°è¯•åœ¨åŒä¸€ä¸ª AZ
NodeGroup scale ä½† capacity ä¸å¢åŠ 
æ— å‘Šè­¦ / æ— è‡ªåŠ¨æ¢å¤
ä¸¤ç§åœºæ™¯çš„å…³é”®å·®å¼‚ï¼ˆç»™ reviewer ç”¨ï¼‰
é¡¹ç›®
EC2 åº”ç”¨
EKS åº”ç”¨
Failover å•ä½
Instance
Node + Pod
å…³é”®é…ç½®
ASG AZ åˆ†å¸ƒ
NodeGroup AZ
ä¸»è¦é£é™©
å®¹é‡ä¸å›è¡¥
Pod Pending
æˆåŠŸæ ‡å‡†
å®ä¾‹æ¢å¤
Pod Running
ä¸€å¥è¯æ€»ç»“ï¼ˆä½ å¯ä»¥ç›´æ¥ç”¨ï¼‰
EC2 åœºæ™¯éªŒè¯ ASG çš„ AZ-level capacity failover èƒ½åŠ›ï¼›
EKS åœºæ™¯éªŒè¯ NodeGroup ä¸ Kubernetes scheduler åœ¨ AZ failure ä¸‹çš„è‡ªæ„ˆä¸è°ƒåº¦èƒ½åŠ›ã€‚
å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘ä¸‹ä¸€æ­¥å¯ä»¥å¸®ä½ ï¼š
ğŸ” Review ä½ ç°æœ‰ ASG / NodeGroup é…ç½®æ˜¯å¦çœŸçš„æ”¯æŒ AZ failover
ğŸ§ª ç»™ä½ ä¸€ä»½ Expected Metrics & Alarms Checklist
ğŸ“„ å¸®ä½ æŠŠè¿™å¥—å†…å®¹æ•´ç†æˆ Chaos Experiment æ–‡æ¡£æ¨¡æ¿ï¼ˆç»™ SRE / Auditï¼‰
ä½ è¿™ä¸ªé—®é¢˜å·²ç»æ˜¯ SRE / æ¶æ„è¯„å®¡çº§åˆ« äº†ã€‚