æ˜¯çš„ï¼Œä½ å®Œå…¨å¯ä»¥åœ¨ GitLab CI/CD ä¸­ä½¿ç”¨ â€œä¸‹æ‹‰æ¡†â€æ‰‹åŠ¨è§¦å‘ä¸€ä¸ªç»Ÿä¸€çš„ Job åï¼ˆæ¯”å¦‚ stateï¼‰ï¼Œè€Œ ä¸åœ¨ UI ä¸­æš´éœ²æ‰€æœ‰ 5 ä¸ªå†…éƒ¨ jobï¼Œè¿™é€šå¸¸å€ŸåŠ©ï¼š

ä¸€ä¸ªæ‰‹åŠ¨è§¦å‘çš„â€œå…¥å£ Jobâ€

å†é€šè¿‡ needsã€triggerã€æˆ–è„šæœ¬å†…éƒ¨é€»è¾‘é€‰æ‹©æ€§è°ƒç”¨å…¶ä»– Job



---

âœ… ç¤ºä¾‹ç›®æ ‡

ä½ æƒ³è¦çš„æ•ˆæœæ˜¯ï¼š

> Pipeline é¡µé¢åªæ˜¾ç¤ºä¸€ä¸ªæ‰‹åŠ¨ Job å« stateï¼Œç‚¹å‡»åå¯ä»¥æ‰§è¡Œåç»­å¤šä¸ª jobï¼ˆ5 ä¸ªä¹‹ä¸€æˆ–å…¨éƒ¨ï¼‰ã€‚




---

âœ… æ–¹æ¡ˆä¸€ï¼šä¸€ä¸ª manual Jobï¼Œè°ƒç”¨åç»­ job

stages:
  - trigger
  - run

# ä¸‹æ‹‰æ¡†åªçœ‹åˆ°è¿™ä¸ª
state:
  stage: trigger
  script:
    - echo "This is the trigger job"
  when: manual
  allow_failure: false

# åç»­ jobï¼Œé»˜è®¤ä¸è·‘ï¼Œé™¤éæ‰‹åŠ¨ç‚¹å‡» state åè§¦å‘
job1:
  stage: run
  script: echo "Running job1"
  needs: [state]

job2:
  stage: run
  script: echo "Running job2"
  needs: [state]

job3:
  stage: run
  script: echo "Running job3"
  needs: [state]

job4:
  stage: run
  script: echo "Running job4"
  needs: [state]

job5:
  stage: run
  script: echo "Running job5"
  needs: [state]

âœ… æ•ˆæœï¼š

Pipeline é¡µé¢åªæ˜¾ç¤ºä¸€ä¸ª manual Job å« stateã€‚

ç‚¹å‡»åï¼Œæ‰ä¼šä¾èµ–åœ°è§¦å‘åç»­ job1~job5ã€‚

ä½ ä¹Ÿå¯ä»¥åœ¨ state é‡Œé¢ç”¨å˜é‡æˆ–è„šæœ¬ï¼Œå†³å®šå…·ä½“æ‰§è¡Œå“ªå‡ ä¸ªã€‚



---

âœ… æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ rules: æ§åˆ¶æ˜¾ç¤ºå’Œè§¦å‘

ä½ å¯ä»¥ç”¨ä¸€ä¸ªå˜é‡æ§åˆ¶å“ªä¸ª Job å¯ç”¨ï¼Œè¿™æ · UI é¡µé¢å°±åªæ˜¾ç¤ºä½ è¦çš„é‚£ä¸ª jobã€‚

job1:
  script: echo "Run job1"
  rules:
    - if: '$TARGET_JOB == "job1"'
      when: manual

job2:
  script: echo "Run job2"
  rules:
    - if: '$TARGET_JOB == "job2"'
      when: manual

åœ¨ Pipeline run æ—¶é€šè¿‡ å˜é‡é€‰æ‹©ï¼ˆæ¯”å¦‚è®¾ç½® TARGET_JOB=job1ï¼‰ï¼Œåªæ˜¾ç¤ºä¸€ä¸ª jobã€‚

ä½†è¿™ä¸ªæ–¹æ³•éœ€è¦ä½ ç‚¹å‡»â€œRun pipelineâ€æ—¶ä¼ å˜é‡ï¼Œä¸æ˜¯é€šè¿‡ UI çš„â€œä¸‹æ‹‰æŒ‰é’®â€ã€‚


---

âœ… æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨ Child Pipelineï¼ˆæ›´é«˜çº§ï¼‰

å¦‚æœä½ æƒ³ç‚¹å‡» stateï¼Œç„¶åç”±å®ƒè§¦å‘å¦ä¸€ä¸ªå­ pipelineï¼ˆåŒ…å« job1~job5ï¼‰ï¼Œé‚£å¯ä»¥ï¼š

state:
  stage: trigger
  trigger:
    include: child-jobs.yml
  when: manual

å­ pipeline é‡Œå°±æ”¾ job1~5ï¼Œä¸»ç•Œé¢çœ‹ä¸åˆ°å®ƒä»¬ï¼Œåªçœ‹åˆ° state å…¥å£ã€‚


---

ğŸ”š æ€»ç»“æ¨è

æ–¹æ¡ˆ	ä¼˜ç‚¹	ç¼ºç‚¹	é€‚åˆæƒ…å†µ

needs: + manual trigger	ç®€å•ï¼ŒUI åªæ˜¾ç¤ºä¸€ä¸ªæŒ‰é’®	åç»­ jobå…¨è·‘	job å›ºå®š
rules: + å˜é‡æ§åˆ¶	æ§åˆ¶æ˜¾ç¤º job å	éœ€è¦ä¼ å˜é‡	æƒ³åŠ¨æ€é€‰æ‹© job
trigger: å­ pipeline	ä¸» pipeline ç•Œé¢ç®€æ´	é…ç½®ç¨å¤æ‚	job å¾ˆå¤šæƒ³éšè—



---

å¦‚ä½ å‘ä¸€ä¸‹ .gitlab-ci.yml ç»“æ„å’Œè¿™ 5 ä¸ª job çš„æ‰§è¡Œé€»è¾‘ï¼ˆæ˜¯å¦éœ€è¦é€‰æ‹©æ€§è¿è¡Œï¼‰ï¼Œæˆ‘å¯ä»¥å¸®ä½ å†™ä¸€ä»½å®šåˆ¶åŒ–çš„ç®€æ´é…ç½®ã€‚

