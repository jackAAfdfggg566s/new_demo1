å“ˆå“ˆï¼Œè¿™å°±å¯¹ä¸Šäº†ï¼Œä½ æ²¡çœ‹åˆ° â€œPlay all manual jobsâ€ æŒ‰é’®æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºè¿™ä¸ªæŒ‰é’®ä¸æ˜¯åœ¨æ‰€æœ‰åœ°æ–¹éƒ½å‡ºç°ï¼Œå¾—æ»¡è¶³å‡ ä¸ªæ¡ä»¶æ‰ä¼šæ˜¾ç¤ºã€‚

æˆ‘å¸®ä½ æ¢³ç†ä¸€ä¸‹ï¼š


---

1ï¸âƒ£ ä»€ä¹ˆæ—¶å€™ä¼šå‡ºç° â€œPlay all manual jobsâ€

æ¡ä»¶ï¼š

1. è¿™ä¸ª Stage é‡Œæœ‰å¤šä¸ª when: manual çš„ jobã€‚


2. è¿™äº› job å¤„äºåŒä¸€ä¸ª stage å¹¶ä¸”éƒ½è¿˜æ²¡è¿è¡Œã€‚



ä½ç½®ï¼š

åœ¨ Pipeline è§†å›¾ï¼ˆCI/CD â†’ Pipelines â†’ ç‚¹å‡»æŸä¸ª Pipelineï¼‰ çš„ Stage å³ä¸Šè§’ï¼Œæ‰‹åŠ¨ job çš„ stage ä¼šæœ‰ä¸ªæŒ‰é’®ï¼š

å¯èƒ½å†™ç€ "Play all" æˆ– â–¶ Run all manual jobsã€‚


åœ¨ Job åˆ—è¡¨è§†å›¾æ˜¯çœ‹ä¸åˆ°çš„ï¼Œè¦è¿› Pipeline è¯¦æƒ…é¡µã€‚




---

2ï¸âƒ£ å¦‚æœä¸æƒ³æ‰¾æŒ‰é’®

ä½ ä¹Ÿå¯ä»¥ç”¨æˆ‘åˆšæ‰æçš„ ä¸€ä¸ªè§¦å‘å™¨ job å¯åŠ¨å¤šä¸ª job çš„æ–¹æ³•ï¼š

ä½ åªç‚¹å‡»ä¸€ä¸ª jobï¼ˆtrigger_failover_allï¼‰ï¼ŒGitLab ä¼šç”¨ needs: å¹¶è¡Œå¯åŠ¨å¦å¤–ä¸¤ä¸ª failover jobã€‚

è¿™æ ·æ¯”æ‰¾æŒ‰é’®çœå¿ƒã€‚



---

3ï¸âƒ£ å»ºè®®ä½ è¯•ä¸€ä¸‹æœ€å°åŒ– demo

stages:
  - failover

trigger_failover_all:
  stage: failover
  when: manual
  script:
    - echo "Trigger both accounts"

failover_account_a:
  stage: failover
  needs: [trigger_failover_all]
  script:
    - echo "Failover AWS Account A"

failover_account_b:
  stage: failover
  needs: [trigger_failover_all]
  script:
    - echo "Failover AWS Account B"

æ‰§è¡Œæ•ˆæœï¼š

ä½ åªç‚¹å‡»ä¸€æ¬¡ trigger_failover_allï¼ˆmanual jobï¼‰ã€‚

GitLab ä¼šå¹¶è¡Œå¯åŠ¨ failover_account_a å’Œ failover_account_bã€‚



---

æˆ‘å¯ä»¥å¸®ä½ æ”¹æˆ é€‚é…ä½ ä¸¤ä¸ª AWS account çš„çœŸå® AssumeRole + FIS å¯åŠ¨å®éªŒ çš„ç‰ˆæœ¬ï¼ˆç‚¹ä¸€æ¬¡æŒ‰é’®ï¼Œä¸¤ä¸ª account å¹¶è¡Œ failoverï¼‰ã€‚
ğŸ‘‰ è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ªç›´æ¥å¯ç”¨çš„å®Œæ•´ç‰ˆï¼ˆå¸¦ AWS CLIï¼‰ï¼Ÿè¿™æ ·ä½ æµ‹è¯•æ—¶å°±ä¸ç”¨æ”¹æ¥æ”¹å»äº†ã€‚

