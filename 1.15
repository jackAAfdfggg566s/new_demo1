ä¸‹é¢ç»™ä½  æ ‡å‡†åšæ³•ï¼šShell å‡½æ•°è¿”å›â€œæ•°ç»„â€ + å¤–éƒ¨éå†ä½¿ç”¨ï¼ŒåŒ…æ‹¬ä¸¤ç§æœ€å®ç”¨æ¨¡å¼ ğŸ‘‡
ğŸ‘‰ é‡ç‚¹ç»“è®ºå…ˆç»™ä½ ï¼š
Shell å‡½æ•°ä¸èƒ½â€œçœŸæ­£ return æ•°ç»„â€
æ­£ç¡®åšæ³•æ˜¯ï¼šè¦ä¹ˆç”¨ echo è¾“å‡ºå†æ¥æ”¶ï¼Œè¦ä¹ˆç”¨å…¨å±€æ•°ç»„ï¼ˆæ¨èï¼‰
âœ… æ–¹æ³• 1 â€”â€” å‡½æ•°ä¿®æ”¹å…¨å±€æ•°ç»„ï¼ˆæœ€ç¨³å¦¥ã€æœ€å¸¸ç”¨ï¼‰
å†™æ³•
å¤åˆ¶ä»£ç 
Bash
get_nodes() {
  result_nodes=()   # å…ˆæ¸…ç©º

  for node in $(kubectl get nodes -o name); do
    az=$(kubectl get "$node" -o jsonpath='{.metadata.labels.topology\.kubernetes\.io/zone}')

    if [[ "$az" == "ap-southeast-2a" || "$az" == "ap-southeast-2b" ]]; then
      result_nodes+=("$node")
    fi
  done
}
è°ƒç”¨ + éå†
å¤åˆ¶ä»£ç 
Bash
get_nodes   # è°ƒç”¨å‡½æ•°

for n in "${result_nodes[@]}"; do
  echo "selected node: $n"
done
âœ… æ–¹æ³• 2 â€”â€” å‡½æ•°æ‰“å°ç»“æœï¼Œå¤–é¢ç”¨ mapfile æ¥æ”¶ï¼ˆæ¨èç»™ Pipeline åœºæ™¯ï¼‰
å‡½æ•°åªè´Ÿè´£â€œè¾“å‡ºâ€
å¤åˆ¶ä»£ç 
Bash
get_nodes() {
  for node in $(kubectl get nodes -o name); do
    az=$(kubectl get "$node" -o jsonpath='{.metadata.labels.topology\.kubernetes\.io/zone}')

    if [[ "$az" == "ap-southeast-2a" || "$az" == "ap-southeast-2b" ]]; then
      echo "$node"
    fi
  done
}
å¤–é¢æ¥æ”¶æˆæ•°ç»„ + éå†
å¤åˆ¶ä»£ç 
Bash
mapfile -t nodes < <(get_nodes)

for n in "${nodes[@]}"; do
  echo "node = $n"
done
âœ… æ–¹æ³• 3 â€”â€” å¦‚æœä½ åªæ˜¯â€œå¤„ç†è¿”å›å€¼è€Œä¸æ˜¯ä¿å­˜â€
å¯ä»¥ç›´æ¥è¿™æ ·ï¼š
å¤åˆ¶ä»£ç 
Bash
while read node; do
  echo "processing $node"
done < <(get_nodes)
âœ… æœ€è´´è¿‘ä½  EKS åœºæ™¯çš„å®Œæ•´ç¤ºä¾‹
å¤åˆ¶ä»£ç 
Bash
get_az_nodes() {
  local az_filter="$1"

  for node in $(kubectl get nodes -o name); do
    az=$(kubectl get "$node" -o jsonpath='{.metadata.labels.topology\.kubernetes\.io/zone}')
    if [[ "$az" == "$az_filter" ]]; then
      echo "$node"
    fi
  done
}

mapfile -t nodes < <(get_az_nodes "ap-southeast-2a")

for n in "${nodes[@]}"; do
  echo "2a node: $n"
done
ğŸ‘‰ å¦‚æœä½ æœ‰ç°æˆè„šæœ¬
æŠŠä½ çš„ å‡½æ•°åŸä»£ç  ç²˜ä¸Šæ¥ï¼Œæˆ‘å¯ä»¥å¸®ä½ åŸåœ°æ”¹æˆå¯è¿è¡Œç‰ˆæœ¬ï¼ˆåŒ…æ‹¬ GitLab pipeline / sh åœºæ™¯ï¼‰ã€‚