æˆ‘ç›´æ¥ç”¨æ¸…æ™°ã€å¯æ“ä½œçš„æ–¹å¼å›ç­”ä½ è¿™ä¸¤ä¸ªé—®é¢˜ â€”â€” Kafka çš„ egressã€A çš„ ingress æ˜¯å¦è¯¥ç”¨ï¼Œä»¥åŠä»€ä¹ˆæ—¶å€™æœ‰ç”¨ã€ä»€ä¹ˆæ—¶å€™æ²¡ç”¨ï¼Œé¿å…ä½ èµ°å¼¯è·¯ã€‚
âœ… ä¸€å¥è¯ç»“è®ºï¼ˆæœ€é‡è¦ï¼‰
ğŸ‘‰ å¦‚æœç›®æ ‡æ˜¯ï¼š
â€œè®© Kafka çœ‹ä¸åˆ° A çš„å¿ƒè·³ / A è¿ä¸ä¸Š Kafkaâ€
ä½ åªéœ€è¦æ–­ï¼šA çš„ egressï¼ˆå‡ºç«™ï¼‰
âŒ ä¸ç”¨æ–­ Kafka egressï¼Œä¹Ÿä¸ç”¨æ–­ A ingressã€‚
ä¸‹é¢æˆ‘è§£é‡Šä¸ºä»€ä¹ˆï¼Œä»¥åŠä»€ä¹ˆæ—¶å€™æ‰éœ€è¦ä½ æåˆ°çš„ä¸¤ç§æ–¹å¼ã€‚
ä¸€ã€å…ˆæ¾„æ¸…æ–¹å‘ï¼ˆå¾ˆå…³é”®ï¼‰
æˆ‘ä»¬æŠŠç½‘ç»œæ–¹å‘ç”»æ¸…æ¥šï¼š
å¤åˆ¶ä»£ç 

A (EKS Pod)  ----->  Kafka (EKS Pod)
      egress           ingress
ä½ çœŸæ­£æƒ³æ¨¡æ‹Ÿçš„æ˜¯ï¼š
A å‘ä¸å‡ºè¯·æ±‚åˆ° Kafka
æ‰€ä»¥ï¼š
ğŸ‘‰ æ§åˆ¶ç‚¹ = A çš„ egressï¼ˆæœ€å¹²å‡€ã€æœ€å°èŒƒå›´ã€æœ€æ ‡å‡†ï¼‰ã€‚
äºŒã€é‚£ä½ é—®çš„ä¸¤ç§æ–¹å¼åˆ†åˆ«æ„å‘³ç€ä»€ä¹ˆï¼Ÿ
âœ… 1ï¼‰Kafka çš„ egressï¼ˆå‡ºç«™ï¼‰â€”â€”é€šå¸¸âŒä¸å¯¹
å¦‚æœä½ æ–­ Kafka çš„ egressï¼Œæ•ˆæœæ˜¯ï¼š
å¤åˆ¶ä»£ç 

A ---> Kafka  âœ…ï¼ˆAè¿˜èƒ½è¿ï¼‰
Kafka ---> å¤–éƒ¨ âŒï¼ˆKafkaå‘ä¸å‡ºå»ï¼‰
è¿™ä¼šå¯¼è‡´ï¼š
Kafka è¿˜èƒ½æ¥æ”¶åˆ° A çš„å¿ƒè·³
ä½† Kafka æ— æ³•å›å¤ A
ä½ ä¼šçœ‹åˆ°ï¼š
A æŠ¥ Timeout
Kafka å…¶å®â€œçœ‹åˆ°äº†è¯·æ±‚â€
ğŸ‘‰ è¿™æ¨¡æ‹Ÿçš„æ˜¯ï¼š
Kafka è‡ªèº«å‘å¤–é€šä¿¡æ•…éšœ
è€Œä¸æ˜¯ A çœ‹ä¸åˆ° Kafka
ä»€ä¹ˆæ—¶å€™æœ‰ç”¨ï¼Ÿ
åªæœ‰å½“ä½ æƒ³æµ‹è¯•ï¼š
Kafka â†’ å…¶ä»–ç³»ç»Ÿï¼ˆSchema Registryã€Metricsã€Mirrorã€å¤–éƒ¨ sinkï¼‰å¤±è´¥
æˆ– Kafka éœ€è¦å¾€å¤–éƒ¨æ¨æ•°æ®æ—¶
ğŸ‘‰ å¯¹ä½ çš„â€œå¿ƒè·³/è¿æ¥æµ‹è¯•åœºæ™¯æ²¡å•¥æ„ä¹‰ã€‚
âœ… 2ï¼‰A çš„ ingressï¼ˆå…¥ç«™ï¼‰â€”â€”é€šå¸¸âŒä¹Ÿä¸å¯¹
å¦‚æœä½ æ–­ A çš„ ingressï¼Œæ•ˆæœæ˜¯ï¼š
å¤åˆ¶ä»£ç 

Kafka ---> A  âŒï¼ˆAæ”¶ä¸åˆ°å›åŒ…ï¼‰
A ---> Kafka  âœ…ï¼ˆAèƒ½å‘ï¼‰
ç»“æœï¼š
A ä¾ç„¶èƒ½å‘ Kafka å‘é€å¿ƒè·³
Kafka è®¤ä¸º A åœ¨çº¿
åªæ˜¯ A çœ‹ä¸åˆ° Kafka çš„å“åº”
ğŸ‘‰ ä½ ä¼šå¾—åˆ°ä¸€ä¸ªéå¸¸æ··ä¹±çš„çŠ¶æ€ï¼š
Kafka è§‰å¾— consumer è¿˜åœ¨
A å´åœ¨ä¸æ–­é‡è¯•
è§¦å‘å¥‡æ€ªçš„ half-open çŠ¶æ€
è¿™ä¸æ˜¯ä½ æƒ³è¦çš„ç½‘ç»œåˆ†åŒºæ¨¡å‹ã€‚
ä¸‰ã€æ­£ç¡®æ¨¡å‹ï¼ˆä½ çœŸæ­£æƒ³è¦çš„ï¼‰
ä½ æƒ³æ¨¡æ‹Ÿçš„æ˜¯å•å‘åˆ†åŒºï¼šA â†’ Kafka æ–­å¼€
å¤åˆ¶ä»£ç 

A  --X-->  Kafka   ï¼ˆæ–­è¿™é‡Œï¼‰
âœ… FIS é‡Œæœ€æ ‡å‡†é…ç½®ï¼š
åœ¨ FIS Templateï¼š
å¤åˆ¶ä»£ç 
Json
{
  "actionId": "aws:ec2:network-disrupt-connectivity",
  "parameters": {
    "scope": "egress",
    "duration": "PT60S"
  }
}
Targetï¼š
A æ‰€åœ¨çš„ EKS NodeGroup
è¿™ç­‰ä»·äºï¼š
A çœ‹ä¸åˆ° Kafka
Kafka ä¾ç„¶å¥åº·
å…¶ä»–æœåŠ¡ä¸å—å½±å“
ğŸ‘‰ è¿™æ˜¯ Chaos Engineering çš„æœ€ä½³å®è·µã€‚
å››ã€ä»€ä¹ˆæ—¶å€™ä½ â€œçœŸçš„â€éœ€è¦ Kafka ingress/egressï¼Ÿ
æˆ‘ç»™ä½ ä¸€å¼ å¿«é€Ÿå†³ç­–è¡¨ï¼š
ä½ çš„ç›®æ ‡
åº”è¯¥æ–­ä»€ä¹ˆ
A è¿ä¸ä¸Š Kafka
âœ… A egress
Kafka è‡ªå·±æ•…éšœ
Kafka Pod kill / CPU / disk
Kafka æ— æ³•å›å¤å®¢æˆ·ç«¯
Kafka egress
æ¨¡æ‹Ÿæ•´ä¸ªé›†ç¾¤ç½‘ç»œæ··ä¹±
A ingress + egress
åªå½±å“ A
åªåŠ¨ Aï¼Œä¸åŠ¨ Kafka
äº”ã€å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘ç»™ä½ ä¸¤ä¸ªå¯å¤ç°å®éªŒ
ğŸ”¹ å®éªŒ 1ï¼ˆæ¨èï¼‰â€”â€”ä½ çš„åœºæ™¯
â€œKafka çœ‹ä¸åˆ° A å¿ƒè·³â€
FISï¼šæ–­ A NodeGroup egress 60s
é¢„æœŸï¼š
Kafka logsï¼šconsumer lost heartbeat
A logsï¼štimeout / disconnect
å…¶ä»– Kafka å®¢æˆ·ç«¯æ­£å¸¸
ğŸ”¹ å®éªŒ 2ï¼ˆå¯¹ç…§ç»„ï¼‰â€”â€”ä½ æåˆ°çš„ Kafka egress
FISï¼šæ–­ Kafka NodeGroup egress 60s
é¢„æœŸï¼š
Kafka è¿˜èƒ½çœ‹åˆ° A
A ç«¯å¤§é‡ timeout
Kafka æœ¬èº«æŒ‡æ ‡æ¶åŒ–
ğŸ‘‰ ä½ ä¼šå‘ç°è¿™ä¸æ˜¯ä½ æƒ³è¦çš„ç»“æœã€‚
å…­ã€æˆ‘å¯ä»¥å¸®ä½ å†™â€œå¯è¿è¡Œæ¨¡æ¿â€
å‘Šè¯‰æˆ‘ä¸€å¥ï¼š
1ï¸âƒ£ A è·‘åœ¨å“ªä¸ª NodeGroup åå­—ï¼Ÿ
2ï¸âƒ£ Kafka æ˜¯ Strimzi / Confluent / è‡ªå»ºï¼Ÿ
3ï¸âƒ£ ä½ æƒ³è¦ 60s FIS è¿˜æ˜¯ 10s ç§’çº§è„šæœ¬ï¼Ÿ
æˆ‘å°±ç»™ä½ ï¼š
å®Œæ•´ FIS JSON +
Kafka æŒ‡æ ‡çœ‹æ¿ +
å®éªŒæˆåŠŸåˆ¤å®šæ¡ä»¶ã€‚