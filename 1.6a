å®Œå…¨æœ‰å¯èƒ½ï¼Œä½ æŠ¥é”™çš„é—®é¢˜å°±æ˜¯ filters é‡Œå†™äº† Placement.AvailabilityZoneï¼Œä½† FIS æ‰¾ä¸åˆ°è¿™ä¸ªå­—æ®µã€‚æˆ‘ç»™ä½ å®Œæ•´åˆ†æä¸€ä¸‹ã€‚
ä¸€ã€Placement.AvailabilityZone çš„æ¥æº
è¿™æ˜¯ EC2 describe-instances API è¿”å›çš„å­—æ®µ
ç¤ºä¾‹ï¼š
å¤åˆ¶ä»£ç 
Json
{
  "Reservations": [
    {
      "Instances": [
        {
          "InstanceId": "i-0abcd1234efgh5678",
          "InstanceType": "m5.large",
          "Placement": {
            "AvailabilityZone": "ap-southeast-2a",
            "Tenancy": "default"
          },
          "State": {
            "Name": "running"
          }
        }
      ]
    }
  ]
}
FIS filters çš„ path å¿…é¡»å’Œè¿™ä¸ª JSON path ä¸€è‡´
æ³¨æ„ï¼š
Placement æ˜¯å¯¹è±¡
AvailabilityZone æ˜¯å®ƒçš„å­å­—æ®µ
å†™æ³•ï¼š
å¤åˆ¶ä»£ç 
Json
"path": "Placement.AvailabilityZone"
äºŒã€æ€ä¹ˆç¡®è®¤å­—æ®µå­˜åœ¨
1ï¸âƒ£ CLI éªŒè¯
å¤åˆ¶ä»£ç 
Bash
aws ec2 describe-instances \
    --instance-ids i-xxxxxxxxxxxx \
    --query "Reservations[*].Instances[*].[InstanceId,Placement.AvailabilityZone,InstanceType,State.Name]"
å¦‚æœè¿”å›æœ‰å€¼ â†’ å­—æ®µå­˜åœ¨
å¦‚æœæŠ¥é”™ â†’ å†™æ³•ä¸å¯¹
âœ… æ³¨æ„ï¼šPlacement.AvailabilityZone æ˜¯å¤§å°å†™æ•æ„Ÿçš„
2ï¸âƒ£ æ£€æŸ¥ FIS æ”¯æŒå­—æ®µ
FIS å®˜æ–¹æ–‡æ¡£å†™æ˜ï¼š
filters.path å¯ä»¥å¼•ç”¨ EC2 DescribeInstances è¿”å›çš„ä»»ä½•é¡¶å±‚æˆ–åµŒå¥—å­—æ®µ
å°å†™/å¤§å°å†™å¿…é¡»å’Œ JSON åŒ¹é…
Placement.AvailabilityZone æ˜¯æ­£ç¡®çš„å­—æ®µå
ä¸‰ã€å¸¸è§è¸©å‘
å­—æ®µå†™é”™
å†™æˆ "placement.availabilityZone" â†’ âŒ
å¿…é¡» "Placement.AvailabilityZone"
å®ä¾‹ä¸æ˜¯ running
filters é‡ŒåŠ  "InstanceState.Name":"running"ï¼Œå¦‚æœå®ä¾‹æ˜¯ stopped â†’ é€‰ä¸åˆ° â†’ æŠ¥é”™
AZ æ‹¼å†™é”™è¯¯
AWS è¿”å›çš„æ˜¯ "ap-southeast-2a"
å†™ "ap-southeast-2-A" â†’ âŒ
ä½¿ç”¨ EC2 ä¸æ˜¯ä½ çš„è´¦æˆ·æˆ–åŒºåŸŸ
FIS ä¼šæ‰¾ä¸åˆ°å®ä¾‹ â†’ æŠ¥é”™
å››ã€æµ‹è¯•å¯è¡Œ filters
å¦‚æœä½ æƒ³æµ‹è¯•ä½  3 å°å®ä¾‹èƒ½å¦è¢« FIS é€‰ä¸­ï¼š
å¤åˆ¶ä»£ç 
Bash
aws ec2 describe-instances \
  --filters "Name=availability-zone,Values=ap-southeast-2a" "Name=instance-state-name,Values=running" \
  --query "Reservations[*].Instances[*].[InstanceId,InstanceType,Placement.AvailabilityZone]"
è¿”å›å®ä¾‹åˆ—è¡¨ â†’ è¯´æ˜ filters å¯ç”¨
FIS å°±èƒ½é€‰ä¸­
ğŸ’¡ æ€»ç»“
ä½ æŠ¥é”™ä¸ä¸€å®šæ˜¯ tag é—®é¢˜ï¼Œæ›´å¯èƒ½æ˜¯ï¼š
Placement.AvailabilityZone å†™é”™ï¼ˆå¤§å°å†™æ•æ„Ÿï¼‰
filters é€‰ä¸åˆ°å®ä¾‹ï¼ˆAZ æˆ– state ä¸å¯¹ï¼‰
å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å¸®ä½ å†™ä¸€ä¸ª ç»å¯¹å¯é€‰ä¸­ç°æœ‰ 3 å° EC2ã€æ—  tagã€AZ + instanceType + state çš„ FIS templateï¼Œ
50% æ³¨å…¥ capacity error
åˆ›å»º template ä¸ä¼šæŠ¥é”™
ä½ å¸Œæœ›æˆ‘ç›´æ¥å¸®ä½ å†™å—ï¼Ÿ