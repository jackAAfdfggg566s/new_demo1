éå¸¸å®ç”¨çš„é—®é¢˜ ğŸ‘‡
AWS é‡Œ EC2 å®ä¾‹è¢« Terminated åï¼Œ
ä½ è™½ç„¶ä¸èƒ½å† describe-instances è·å–è¿è¡Œä¸­ä¿¡æ¯ï¼Œ
ä½†å¯ä»¥é€šè¿‡ CloudTrail æˆ– CloudWatch Logs / AWS CLI / Console æŸ¥å‡ºå‡†ç¡®çš„ç»ˆæ­¢æ—¶é—´ã€‚
ä¸‹é¢æˆ‘æŒ‰å®ç”¨ç¨‹åº¦ä»æœ€æ–¹ä¾¿åˆ°æœ€ç²¾å‡†ç»™ä½ å‡ ç§æ–¹æ³•ã€‚


---

âœ… 1ï¸âƒ£ AWS æ§åˆ¶å°ï¼ˆæœ€ç›´è§‚ï¼‰

1. ç™»å½• AWS Console â†’ EC2 â†’ Instances â†’ Terminated å®ä¾‹ï¼›


2. é€‰ä¸­ä½ çš„å®ä¾‹ï¼›


3. åœ¨åº•éƒ¨ â€œDescriptionâ€ æ ‡ç­¾é¡µ é‡Œçœ‹ï¼š

State transition reason ä¸€æ ï¼›

æˆ– State change timeï¼ˆæœ€è¿‘çŠ¶æ€å˜æ›´æ—¶é—´ï¼‰ã€‚




> âš ï¸ è¿™ä¸ªæ—¶é—´å°±æ˜¯å®ä¾‹è¿›å…¥ â€œterminatedâ€ çŠ¶æ€çš„æ—¶é—´ç‚¹ã€‚
é€šå¸¸ç²¾ç¡®åˆ°ç§’ã€‚




---

âœ… 2ï¸âƒ£ AWS CLI å‘½ä»¤è¡Œï¼ˆæ¨èåšè‡ªåŠ¨åŒ–æ—¶ï¼‰

ğŸ§© æ–¹æ³• Aï¼šdescribe-instancesï¼ˆå¦‚æœå®ä¾‹ä¿¡æ¯è¿˜ä¿ç•™ï¼‰

aws ec2 describe-instances --instance-ids i-0123456789abcdef \
  --query "Reservations[].Instances[].StateTransitionReason"

è¾“å‡ºç¤ºä¾‹ï¼š

"User initiated (2025-10-30 02:34:17 GMT)"

â†’ âœ… è¿™ä¸ªæ—¶é—´å°±æ˜¯ Terminate æ“ä½œå‘ç”Ÿçš„æ—¶é—´ã€‚

> æ³¨æ„ï¼šEC2 çš„å…ƒæ•°æ®åœ¨è¢«åˆ é™¤å‡ å°æ—¶åï¼Œdescribe-instances å¯èƒ½æŸ¥ä¸åˆ°ã€‚
å¦‚æœæŸ¥ä¸åˆ°ï¼Œå°±ç”¨ CloudTrailã€‚




---

âœ… 3ï¸âƒ£ AWS CloudTrailï¼ˆæœ€å‡†ç¡®ã€å¯æŸ¥å†å²ï¼‰

CloudTrail ä¼šè®°å½•ä½ æˆ–ç³»ç»Ÿå‘å‡ºçš„ç»ˆæ­¢äº‹ä»¶ï¼ˆTerminateInstancesï¼‰ã€‚

CLI æŸ¥æ³•ï¼š

aws cloudtrail lookup-events \
  --lookup-attributes AttributeKey=ResourceName,AttributeValue=i-0123456789abcdef \
  --query 'Events[?EventName==`TerminateInstances`].[EventTime, Username]' \
  --output table

è¾“å‡ºç¤ºä¾‹ï¼š

---------------------------
|       LookupEvents      |
+----------------+---------+
| 2025-10-30T02:34:17Z | ec2-user |
+----------------+---------+

â†’ EventTime å°±æ˜¯ å®ä¾‹è¢«ç»ˆæ­¢çš„æ—¶é—´ï¼ˆUTCï¼‰ã€‚


---

âœ… 4ï¸âƒ£ é€šè¿‡ CloudWatch Logsï¼ˆå¦‚æœä½ æœ‰æ—¥å¿—æˆ– metricsï¼‰

å¦‚æœä½ æœ‰ç›‘æ§æŒ‡æ ‡ï¼ˆå¦‚ CPUã€Networkï¼‰ï¼Œå¯ä»¥çœ‹å‡ºå¤§è‡´æ—¶é—´ï¼š

aws cloudwatch get-metric-statistics \
  --namespace AWS/EC2 \
  --metric-name CPUUtilization \
  --dimensions Name=InstanceId,Value=i-0123456789abcdef \
  --start-time 2025-10-29T00:00:00Z \
  --end-time 2025-10-30T23:59:59Z \
  --period 300 \
  --statistics Average

æœ€åä¸€ä¸ªç‚¹çš„æ—¶é—´æˆ³é€šå¸¸å°±æ˜¯å®ä¾‹åœæ­¢è¿è¡Œå‰çš„å‡ åˆ†é’Ÿã€‚


---

âœ… 5ï¸âƒ£ å¦‚æœå®ä¾‹å®Œå…¨ä» EC2 åˆ—è¡¨æ¶ˆå¤±

è¿™æ—¶ï¼š

æ§åˆ¶å° â€œTerminatedâ€ çŠ¶æ€çš„è®°å½•ä¼šä¿ç•™ 24 å°æ—¶å†…å¯è§ï¼›

CLI çš„ describe-instances ç»“æœä¹Ÿåªåœ¨é‚£æ®µæ—¶é—´å†…æœ‰æ•ˆï¼›

ä¹‹åå”¯ä¸€æ–¹å¼æ˜¯ CloudTrailï¼ˆä¿ç•™ 90 å¤©ï¼‰ã€‚



---

ğŸ” æ€»ç»“è¡¨ï¼š

åœºæ™¯	æ–¹æ³•	å‘½ä»¤ / è·¯å¾„	èƒ½æŸ¥å¤šä¹…å‰

å®ä¾‹åˆšåˆšç»ˆæ­¢	EC2 æ§åˆ¶å° Description â†’ â€œState transition reasonâ€	â€”	çº¦ 24h
CLI æŸ¥è¯¢	aws ec2 describe-instances	çº¦ 24h	
å†å²è®°å½•	aws cloudtrail lookup-events	é»˜è®¤ä¿ç•™ 90 å¤©	
æŒ‡æ ‡æ¨æ–­	aws cloudwatch get-metric-statistics	ä¾ä½ çš„ç›‘æ§å‘¨æœŸ	



---

æ˜¯å¦è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ªè„šæœ¬ï¼ˆCLI ç‰ˆï¼‰ï¼Œè¾“å…¥ä¸€ä¸ª instance-id è‡ªåŠ¨è¾“å‡ºç»ˆæ­¢æ—¶é—´ï¼Ÿ
æ¯”å¦‚ get-terminated-time.sh i-xxxxxx å°±èƒ½æ‰“å° UTC å’Œæœ¬åœ°æ—¶é—´ã€‚