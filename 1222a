RDS DB instance role = WRITER è¿‡æ»¤ä¸å‡ºæ¥ï¼Œé€šå¸¸ä¸æ˜¯â€œæƒé™é—®é¢˜â€ï¼Œè€Œæ˜¯ä½ ç”¨çš„ç»´åº¦/æ¥å£ä¸å¯¹ã€‚ä¸‹é¢æŒ‰æœ€å¸¸è§ â†’ è¾ƒå°‘è§ç»™ä½ ä¸€å¥—æ’æŸ¥é¡ºåºï¼Œç…§ç€ä¸€æ­¥æ­¥æ¥å°±èƒ½å®šä½ã€‚
ä¸€ã€å…ˆç¡®è®¤ä¸€ä¸ªå…³é”®äº‹å®ï¼ˆæœ€å®¹æ˜“è¸©å‘ï¼‰
ğŸ‘‰ åªæœ‰ Aurora æ‰æœ‰ WRITER / READER è§’è‰²
Auroraï¼ˆMySQL / PostgreSQLï¼‰
âœ… æœ‰ DBInstanceRole = WRITER | READER
æ™®é€š RDSï¼ˆMySQL / Postgres / SQL Server / Oracleï¼‰
âŒ æ²¡æœ‰ WRITER æ¦‚å¿µï¼Œåªæœ‰ä¸€ä¸ªä¸»å®ä¾‹ + åªè¯»å‰¯æœ¬
â†’ ä½ æ€ä¹ˆ filter éƒ½ä¸ä¼šæœ‰ WRITER
ğŸ‘‰ å…ˆç¡®è®¤æ˜¯ä¸æ˜¯ Aurora
å¤åˆ¶ä»£ç 
Bash
aws rds describe-db-instances \
  --db-instance-identifier your-instance-id \
  --query 'DBInstances[0].Engine'
å¦‚æœä¸æ˜¯ aurora-*ï¼Œé‚£ WRITER æœ¬èº«å°±ä¸å­˜åœ¨ï¼Œè¿™æ˜¯â€œæ ¹å› â€ã€‚
äºŒã€Aurora æƒ…å†µä¸‹ï¼Œ90% çš„é—®é¢˜åœ¨è¿™é‡Œ
âŒ é”™è¯¯æ–¹å¼ï¼ˆæœ€å¸¸è§ï¼‰
å¤åˆ¶ä»£ç 
Bash
aws rds describe-db-instances \
  --filters Name=db-instance-role,Values=WRITER
ğŸ‘‰ è¿™ä¸ª filter å¯¹ describe-db-instances ä¸ç”Ÿæ•ˆ
AWS CLI æ ¹æœ¬ä¸ä¼šæŒ‰è¿™ä¸ªå­—æ®µè¿‡æ»¤
ä¸‰ã€âœ… æ­£ç¡®çš„æ’æŸ¥ / è·å– WRITER çš„æ–¹æ³•ï¼ˆæ¨èï¼‰
æ–¹æ³• 1ï¼ˆæœ€ç¨³ï¼‰ï¼šä» DB Cluster ä¸‹æ‰‹
WRITER æ˜¯ cluster çº§åˆ«æ¦‚å¿µ
å¤åˆ¶ä»£ç 
Bash
aws rds describe-db-clusters \
  --db-cluster-identifier your-cluster-name \
  --query 'DBClusters[0].DBClusterMembers'
ä½ ä¼šçœ‹åˆ°ç±»ä¼¼ï¼š
å¤åˆ¶ä»£ç 
Json
[
  {
    "DBInstanceIdentifier": "xxx-1",
    "IsClusterWriter": true
  },
  {
    "DBInstanceIdentifier": "xxx-2",
    "IsClusterWriter": false
  }
]
ğŸ‘‰ IsClusterWriter = true çš„é‚£ä¸ªå°±æ˜¯ WRITER
æ–¹æ³• 2ï¼šdescribe-db-instances + JMESPath è¿‡æ»¤ï¼ˆCLI æ¨èï¼‰
å¤åˆ¶ä»£ç 
Bash
aws rds describe-db-instances \
  --query 'DBInstances[?DBClusterIdentifier!=null].[DBInstanceIdentifier,DBClusterIdentifier,DBInstanceRole,AvailabilityZone]'
å¦‚æœæ˜¯ Auroraï¼ŒDBInstanceRole ä¼šæ˜¾ç¤ºï¼š
WRITER
READER
âš ï¸ æ³¨æ„ï¼šä¸èƒ½ç”¨ --filtersï¼Œåªèƒ½ç”¨ --query
å››ã€å¦‚æœ DBInstanceRole æ˜¯ç©ºçš„ï¼ˆä¹Ÿå¾ˆå¸¸è§ï¼‰
æ’æŸ¥ç‚¹ï¼š
å®ä¾‹ä¸æ˜¯ Aurora
ä½ æŸ¥çš„æ˜¯åªè¯»å‰¯æœ¬
region ä¸å¯¹
cluster å·²è¢« failoverï¼Œä½†ä½ ç¼“å­˜äº†æ—§æ•°æ®
å¿«é€ŸéªŒè¯ regionï¼š
å¤åˆ¶ä»£ç 
Bash
aws configure get region
æˆ–è€…æ˜¾å¼æŒ‡å®šï¼š
å¤åˆ¶ä»£ç 
Bash
aws rds describe-db-clusters --region ap-southeast-2
äº”ã€Failover åœºæ™¯ç‰¹åˆ«å®¹æ˜“è¯¯åˆ¤
å¦‚æœåˆšå‘ç”Ÿè¿‡ failoverï¼š
Writer å·²åˆ‡æ¢
ä½ æŸ¥çš„è¿˜æ˜¯æ—§å®ä¾‹å
Console å’Œ CLI æ˜¾ç¤ºä¸ä¸€è‡´ï¼ˆå‡ åˆ†é’Ÿå†…ï¼‰
ğŸ‘‰ æ°¸è¿œä»¥ describe-db-clusters ä¸ºå‡†
å…­ã€ç»™ä½ ä¸€ä¸ªã€Œä¸€è¡Œç›´æ¥æ‹¿ WRITER å®ä¾‹åã€çš„å®æˆ˜å‘½ä»¤
å¤åˆ¶ä»£ç 
Bash
aws rds describe-db-clusters \
  --db-cluster-identifier your-cluster-name \
  --query 'DBClusters[0].DBClusterMembers[?IsClusterWriter==`true`].DBInstanceIdentifier' \
  --output text
ä¸ƒã€å¦‚æœä½ æ˜¯æƒ³åšè¿™äº›äº‹ï¼ˆæå‰è¯´ï¼Œé¿å…èµ°å¼¯è·¯ï¼‰
ä½ ä¹‹å‰é—®è¿‡ï¼š
æ ¹æ® WRITER / READER æ‰¾ AZ
æ ¹æ® WRITER æ‰¾ subnet
æ ¹æ® WRITER åšè¿ç»´/è„šæœ¬åˆ¤æ–­
ğŸ‘‰ æ­£ç¡®é“¾è·¯ä¸€å®šæ˜¯ï¼š
Cluster â†’ Writer Instance â†’ AZ â†’ Subnet
è€Œä¸æ˜¯åè¿‡æ¥ filter instance
å…«ã€ä½ å¯ä»¥ç›´æ¥æŠŠä¸‹é¢ä¸‰ç‚¹å‘æˆ‘ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç²¾ç¡®å®šä½
ä¸ç”¨æˆªå›¾ï¼Œç›´æ¥æ–‡æœ¬å³å¯ï¼š
Engineï¼ˆaurora-mysql / mysql / postgres â€¦ï¼‰
ä½ ç°åœ¨ç”¨çš„ CLI å‘½ä»¤
describe-db-clusters æœ‰æ²¡æœ‰è¾“å‡º
æˆ‘å¯ä»¥ç›´æ¥å¸®ä½ æ”¹æˆ ä¸€æ¡èƒ½è·‘é€šçš„å‘½ä»¤ã€‚