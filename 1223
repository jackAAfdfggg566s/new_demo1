åœ¨ EKS é‡Œä½ çœ‹åˆ°çš„è¿™ä¸¤ç§å…¶å®æ˜¯ ä¸¤ä¸ªä¸åŒå±‚çº§çš„ AZ æ ‡è¯†ï¼Œå¾ˆå¤šäººéƒ½ä¼šè¢«ç»•æ™• ğŸ‘‡
æˆ‘æŒ‰ã€Œä½ ç°åœ¨åœ¨ CLI / è¿ç»´é‡Œæ€ä¹ˆæ‹¿ã€æ¥è®²ã€‚
ä¸€ã€ä½ çœ‹åˆ°çš„ä¸¤ç§ AZ æ˜¯ä»€ä¹ˆå…³ç³»
1ï¸âƒ£ ap-southeast-2b
è¿™æ˜¯è´¦å·å¯è§çš„ AZ åç§°
ä¸åŒ AWS è´¦å·é‡Œï¼Œ2a / 2b / 2c æ˜ å°„å¯èƒ½ä¸ä¸€æ ·
EKS / EC2 / Subnet é»˜è®¤æ˜¾ç¤ºçš„å°±æ˜¯è¿™ä¸ª
2ï¸âƒ£ apse2-az1
è¿™æ˜¯ AWS å…¨å±€å”¯ä¸€çš„ AZ ID
æ‰€æœ‰è´¦å·é‡Œéƒ½ä¸€æ ·
ç”¨æ¥è§£å†³ â€œä½ è´¦å·çš„ 2b â‰  æˆ‘è´¦å·çš„ 2bâ€ çš„é—®é¢˜
ğŸ‘‰ å¯¹åº”å…³ç³»æ˜¯ï¼š
å¤åˆ¶ä»£ç 

ap-southeast-2b  <-->  apse2-az1
äºŒã€ç”¨ AWS CLI è·å–ã€ŒAZ å â†” AZ IDã€æ˜ å°„ï¼ˆæ ¸å¿ƒï¼‰
âœ… æœ€æ ‡å‡†ã€æ¨èçš„å‘½ä»¤
å¤åˆ¶ä»£ç 
Bash
aws ec2 describe-availability-zones \
  --region ap-southeast-2 \
  --query 'AvailabilityZones[].{AZName:ZoneName, AZId:ZoneId}'
  --output table
ç¤ºä¾‹è¾“å‡º
å¤åˆ¶ä»£ç 

--------------------------------
|  DescribeAvailabilityZones   |
+--------------+---------------+
|   AZName     |     AZId      |
+--------------+---------------+
| ap-southeast-2a | apse2-az3 |
| ap-southeast-2b | apse2-az1 |
| ap-southeast-2c | apse2-az2 |
+--------------+---------------+
ğŸ‘‰ ä½ å°±èƒ½æ¸…æ¥šçœ‹åˆ°
2b å¯¹åº” apse2-az1
ä¸‰ã€ä» EKS Node / EC2 ç›´æ¥çœ‹åˆ° AZ IDï¼ˆä½ æ’æŸ¥æ—¶å¾ˆæœ‰ç”¨ï¼‰
1ï¸âƒ£ é€šè¿‡ Node å¯¹åº”çš„ EC2 å®ä¾‹
å¤åˆ¶ä»£ç 
Bash
aws ec2 describe-instances \
  --instance-ids i-xxxx \
  --query 'Reservations[].Instances[].Placement.{AZ:AvailabilityZone, AZId:AvailabilityZoneId}'
  --output table
è¾“å‡ºç±»ä¼¼ï¼š
å¤åˆ¶ä»£ç 

AZ               AZId
ap-southeast-2b  apse2-az1
å››ã€kubectl é‡Œæ€ä¹ˆçœ‹ï¼ˆEKS å¸¸ç”¨ï¼‰
Node ä¸Šçš„ labelï¼ˆåªæœ‰ AZ åï¼Œæ²¡æœ‰ AZ IDï¼‰
å¤åˆ¶ä»£ç 
Bash
kubectl get nodes --show-labels | grep topology.kubernetes.io/zone
å¸¸è§ labelï¼š
å¤åˆ¶ä»£ç 

topology.kubernetes.io/zone=ap-southeast-2b
âš ï¸ Kubernetes ä¸ä¼šç›´æ¥æš´éœ² apse2-az1 ğŸ‘‰ AZ ID åªèƒ½é€šè¿‡ AWS CLI / EC2 API æŸ¥
äº”ã€è¿ç»´é‡Œå¸¸è§æ­£ç¡®åšæ³•ï¼ˆå¾ˆé‡è¦ï¼‰
å¦‚æœä½ ç°åœ¨åšçš„æ˜¯ï¼š
EKS è·¨ AZ è°ƒåº¦
å¯¹é½ RDS / EBS / Subnet / AZ
å¤šè´¦å·å¯¹é½æ¶æ„
âœ… æ¨èç­–ç•¥
K8s / EKS å±‚ï¼šç”¨ ap-southeast-2b
AWS èµ„æºå¯¹é½ / æ¶æ„æ–‡æ¡£ï¼šç”¨ apse2-az1
å¾ˆå¤šå¤§å‚å°±æ˜¯é  AZ ID æ¥é¿å…äº‹æ•…çš„ã€‚
å…­ã€å¦‚æœä½ ç°åœ¨çš„çœŸå®éœ€æ±‚æ˜¯ğŸ‘‡
ä½ å‰é¢é—®è¿‡å¾ˆå¤šç±»ä¼¼é—®é¢˜ï¼Œæˆ‘çŒœä½ å¯èƒ½æ˜¯æƒ³åšå…¶ä¸­ä¹‹ä¸€ï¼š
âœ… æ‰¾ EKS node æ‰€åœ¨ AZ â†’ å†æ‰¾å¯¹åº” subnet
âœ… å¯¹é½ RDS writer / reader å’Œ EKS node çš„ AZ
âœ… è„šæœ¬é‡Œåˆ¤æ–­ apse2-az1 æ˜¯å¦ç­‰äºæŸä¸ª node
å¦‚æœä½ æ„¿æ„ï¼ŒæŠŠä½ ç°åœ¨çš„ è„šæœ¬ç›®æ ‡ ç›´æ¥è´´å‡ºæ¥
æˆ‘å¯ä»¥å¸®ä½ å†™ä¸€æ®µ ä¸€æ¡ CLI + jq/bash å°±èƒ½è·‘é€šçš„ç‰ˆæœ¬ ğŸ’ª