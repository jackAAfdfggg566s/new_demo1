ğŸ‘Œ æˆ‘æ‡‚äº†ï¼Œä½ è¿™é‡Œçš„å‘ç‚¹æˆ‘å¸®ä½ ä¸€æ­¥æ­¥æ’æŸ¥ã€‚


---

1ï¸âƒ£ å¸¸è§æŠ¥é”™ä¿¡æ¯

Identifier failed to satisfy constraints è¯´æ˜ä¼ ç»™ Identifier çš„å‚æ•°ä¸å¯¹ã€‚
åœ¨ Performance Insights API (pi.get_resource_metrics) é‡Œï¼ŒIdentifier å¿…é¡»æ˜¯ï¼š

RDS / Aurora å®ä¾‹ â†’ ç”¨ DbiResourceIdï¼ˆä¸æ˜¯ DB nameï¼Œä¸æ˜¯ ARNï¼‰

è¦å¯ç”¨äº† Performance Insightsï¼Œå¦åˆ™ API è°ƒç”¨ç›´æ¥æŠ¥é”™



---

2ï¸âƒ£ æ’æŸ¥æ­¥éª¤

âœ… Step 1: ç¡®è®¤ Resource ID æ­£ç¡®

æ‰§è¡Œï¼š

aws rds describe-db-instances \
  --db-instance-identifier mydb \
  --query "DBInstances[*].[DBInstanceIdentifier,DbiResourceId,PerformanceInsightsEnabled]"

è¿”å›ç±»ä¼¼ï¼š

[
  ["mydb", "db-ABCDEFGHIJKLMNOPQRSTUVWX", true]
]

ç¬¬äºŒä¸ªå­—æ®µå°±æ˜¯ä½ è¦ç”¨çš„ Identifierã€‚

ç¡®è®¤ PerformanceInsightsEnabled å¿…é¡»æ˜¯ trueï¼Œå¦åˆ™ API è°ƒä¸äº†ã€‚



---

âœ… Step 2: Lambda é‡Œç”¨ Resource ID

DB_RESOURCE_ID = "db-ABCDEFGHIJKLMNOPQRSTUVWX"  # ä¸Šä¸€æ­¥æŸ¥åˆ°çš„ DbiResourceId

response = pi.get_resource_metrics(
    ServiceType='RDS',
    Identifier=DB_RESOURCE_ID,
    MetricQueries=[
        {"Metric": "db.load.avg"}
    ],
    StartTime=start_time,
    EndTime=end_time,
    PeriodInSeconds=60
)


---

âœ… Step 3: ç¡®è®¤ Region åŒ¹é…

ä½ çš„ Lambda å¿…é¡»å’Œ RDS åœ¨åŒä¸€ä¸ª Regionï¼Œæˆ–è€…æ˜¾å¼æŒ‡å®šï¼š


pi = boto3.client('pi', region_name="ap-southeast-2")


---

âœ… Step 4: æƒé™æ£€æŸ¥

Lambda æ‰§è¡Œè§’è‰²è‡³å°‘è¦æœ‰ï¼š

{
  "Effect": "Allow",
  "Action": [
    "pi:GetResourceMetrics",
    "rds:DescribeDBInstances",
    "cloudwatch:PutMetricData"
  ],
  "Resource": "*"
}


---

âš ï¸ å¯èƒ½çš„å‘

ä½ ä¼ çš„ DB identifierï¼ˆæ¯”å¦‚ "mydb"ï¼‰è‚¯å®šæŠ¥é”™ âŒ

ä½ ä¼ çš„ RDS ARNï¼ˆarn:aws:rds:...ï¼‰ä¹Ÿä¼šæŠ¥é”™ âŒ

åªèƒ½ä¼  DbiResourceId âœ…



---

ğŸ‘‰ å»ºè®®ä½ å…ˆæ‰§è¡Œæˆ‘ä¸Šé¢çš„ CLI å‘½ä»¤ï¼Œçœ‹ä¸€ä¸‹ DbiResourceId å’Œ PerformanceInsightsEnabled çš„å€¼ã€‚

è¦ä¸è¦æˆ‘ç›´æ¥å¸®ä½ å†™ä¸ª Lambda è‡ªåŠ¨å‘ç° Resource ID çš„ä»£ç ï¼Œè¿™æ ·å°±ä¸ç”¨æ‰‹åŠ¨æ”¹ï¼Œæ¯æ¬¡éƒ½èƒ½æŸ¥åˆ°ï¼Ÿ

