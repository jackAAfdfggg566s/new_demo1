å¥½çš„ï¼Œå¦‚æœä½ çš„ç›®æ ‡æ˜¯ï¼š

> âœ… åœ¨è¿œç¨‹æœºå™¨ä¸Šç”¨ Ansible æ‰§è¡Œ tailï¼Œä¸€æ—¦æ£€æµ‹åˆ°æŸä¸ªç‰¹å®šå­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚ â€œSuccessâ€ï¼‰ï¼Œå°±ç«‹å³ç»“æŸä»»åŠ¡ã€‚



é‚£ä¹ˆä½ ç¡®å®ä¸èƒ½ç”¨ä¼ ç»Ÿçš„ tail -f â€”â€” å®ƒä¸ä¼šé€€å‡ºï¼ŒCI ä¼šæŒ‚æ­»ã€‚ä½ éœ€è¦åŠ ä¸€äº›é€»è¾‘ï¼Œè®©å®ƒåŒ¹é…åˆ°å…³é”®å­—åç«‹å³é€€å‡ºã€‚


---

âœ… è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ grep + timeout å®ç°â€œè¾¹çœ‹è¾¹åŒ¹é…ï¼ŒåŒ¹é…å³é€€å‡ºâ€

- name: Wait for log to contain keyword, then exit
  shell: |
    timeout 60 bash -c 'tail -n 0 -F /var/log/myapp.log | grep -m 1 "Success"'
  register: wait_for_log
  ignore_errors: true  # é¿å… timeout æŠ¥é”™ç»ˆæ­¢ CI

- name: Output match result
  debug:
    var: wait_for_log.stdout


---

ğŸ§  è§£é‡Šè¯´æ˜ï¼š

ç»„ä»¶	ä½œç”¨

timeout 60	æœ€å¤šç­‰ 60 ç§’ï¼Œé˜²æ­¢æŒ‚ä½
tail -n 0 -F	ä»æ–‡ä»¶æœ«å°¾å¼€å§‹æŒç»­è·Ÿè¸ªæ–°æ—¥å¿—
grep -m 1 "Success"	ç¬¬ä¸€æ¬¡å‡ºç° "Success" å°±é€€å‡ºæ•´ä¸ªå‘½ä»¤
ignore_errors: true	å¦‚æœ 60 ç§’åæ²¡åŒ¹é…åˆ°ï¼Œä¹Ÿä¸è®© CI æŠ¥é”™å¤±è´¥



---

âœ… æ›¿æ¢å…³é”®è¯ç¤ºä¾‹

æ¯”å¦‚ä½ åœ¨æ—¥å¿—ä¸­è¦ç­‰å¾…è¿™äº›ï¼š

â€œService startedâ€

â€œConnected successfullyâ€

â€œDoneâ€


é‚£ä¹ˆä½ æ”¹ä¸ºï¼š

grep -m 1 "Connected successfully"


---

â±ï¸ Bonusï¼šåŒ¹é…å¤šä¸ªå…³é”®å­—ï¼ˆä»»æ„ä¸€ä¸ªå³å¯ï¼‰

grep -m 1 -E "Success|Done|OK"


---

âœ… æç¤ºï¼šè¿™ç§æ–¹å¼åœ¨ GitLab CI é‡Œéå¸¸å¸¸ç”¨ï¼Œå°¤å…¶ç”¨äºæ£€æµ‹å®¹å™¨æˆ–è¿œç¨‹æœåŠ¡å¯åŠ¨çŠ¶æ€ã€‚


---

âœ… å¦‚æœä½ æƒ³æ‰“å°åŒ¹é…ä¹‹å‰çš„æ—¥å¿—å†…å®¹ï¼Ÿ

ä½ å¯ä»¥ç»„åˆè¾“å‡ºï¼š

- name: Tail log until keyword appears
  shell: |
    timeout 60 bash -c '
      tail -n 0 -F /var/log/myapp.log | tee /tmp/temp_log |
      grep -m 1 "Success"
    '
  register: wait_for_log
  ignore_errors: true

- name: Show tail output
  shell: cat /tmp/temp_log
  register: full_log

- debug:
    var: full_log.stdout_lines


---

ğŸ› ï¸ è¦ä¸è¦æˆ‘ç›´æ¥å¸®ä½ å†™è¿› Ansible Playbookï¼Œæˆ–è€…çœ‹çœ‹ä½ ç°æœ‰çš„ä»»åŠ¡æ€ä¹ˆæ¥è¿›å»ï¼Ÿè´´ä¸€æ®µä½ ç°åœ¨çš„ yamlï¼Œæˆ‘å¯ä»¥ç›´æ¥å¸®ä½ æ•´åˆè¿›å»ã€‚

