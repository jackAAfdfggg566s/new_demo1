å¥½é—®é¢˜ ğŸ‘ï¼Œå°¤å…¶æ˜¯ RDS é€šå¸¸åº”è¯¥è·‘åœ¨ç§æœ‰ Subneté‡Œï¼Œæ‰€ä»¥é€šè¿‡ CLI åŒºåˆ†å…¬æœ‰/ç§æœ‰éå¸¸é‡è¦ã€‚

æ ¸å¿ƒåˆ¤æ–­æ–¹æ³•æ˜¯ï¼šçœ‹ Subnet æ‰€å±çš„ Route Table æœ‰æ²¡æœ‰æŒ‡å‘ Internet Gateway (IGW)ã€‚


---

1ï¸âƒ£ æ‰¾å‡º RDS Subnet IDs

å…ˆæ‹¿åˆ° RDS çš„ Subnet IDsï¼š

aws rds describe-db-instances \
    --db-instance-identifier <your-db-instance> \
    --query "DBInstances[0].DBSubnetGroup.Subnets[].SubnetIdentifier" \
    --output text


---

2ï¸âƒ£ æŸ¥æ¯ä¸ª Subnet çš„ Route Table

è·å– Subnet å…³è”çš„ Route Tableï¼š

aws ec2 describe-route-tables \
    --filters "Name=association.subnet-id,Values=<subnet-id>"

æˆ–è€…ä¸€è¡Œå‘½ä»¤æŸ¥å¤šä¸ªï¼š

aws ec2 describe-route-tables \
    --filters "Name=association.subnet-id,Values=<subnet-id-1>,<subnet-id-2>"


---

3ï¸âƒ£ åˆ¤æ–­å…¬æœ‰ / ç§æœ‰

å¦‚æœ Route Table ä¸­æœ‰ä¸€æ¡è·¯ç”±ï¼š

DestinationCidrBlock: 0.0.0.0/0
GatewayId: igw-xxxxxxx

è¯´æ˜è¿™æ˜¯å…¬æœ‰ Subnetï¼ˆæœ‰ Internet Gateway å‡ºå£ï¼‰

å¦‚æœé»˜è®¤è·¯ç”±æŒ‡å‘ NAT Gateway æˆ–æ²¡æœ‰ IGWï¼š

DestinationCidrBlock: 0.0.0.0/0
NatGatewayId: nat-xxxxxxx

æˆ–

æ²¡æœ‰ 0.0.0.0/0 æŒ‡å‘ IGW

è¯´æ˜æ˜¯ç§æœ‰ Subnet



---

4ï¸âƒ£ ä¸€æ¡å‘½ä»¤ç›´æ¥æ ‡æ³¨å…¬æœ‰/ç§æœ‰

å‡è®¾ä½ æœ‰ Subnet IDsï¼š

for subnet in $(aws rds describe-db-instances \
    --db-instance-identifier <your-db> \
    --query "DBInstances[0].DBSubnetGroup.Subnets[].SubnetIdentifier" \
    --output text); do
    rt=$(aws ec2 describe-route-tables \
        --filters "Name=association.subnet-id,Values=$subnet" \
        --query "RouteTables[0].Routes[].GatewayId" \
        --output text)
    if echo $rt | grep -q igw-; then
        echo "$subnet â†’ Public"
    else
        echo "$subnet â†’ Private"
    fi
done

è¾“å‡ºç¤ºä¾‹ï¼š

subnet-aaaa1111 â†’ Private
subnet-bbbb2222 â†’ Private

ï¼ˆRDS é€šå¸¸éƒ½æ˜¯ Privateï¼‰


---

ğŸ‘‰ ç»“è®ºï¼š

RDS é»˜è®¤å»ºè®®æ”¾ç§æœ‰ Subnetï¼ˆä¸èƒ½ç›´è¿å…¬ç½‘ï¼‰

å…¬ç§å­ç½‘ä¸»è¦é€šè¿‡ Route Table æ˜¯å¦æœ‰ IGW æ¥åˆ¤æ–­

CLI å¯ä»¥æ‰¹é‡æŸ¥å‡ºæ¥



---

æˆ‘é¡ºä¾¿é—®ä¸‹ï¼Œä½ æ˜¯ä¸æ˜¯æƒ³åœ¨ GitLab CI/CD è„šæœ¬é‡Œè‡ªåŠ¨æ£€æµ‹ RDS Subnet æ˜¯ä¸æ˜¯ç§æœ‰ï¼ˆé¿å…è¯¯å»ºåœ¨å…¬æœ‰å­ç½‘ï¼‰ï¼Ÿæˆ‘å¯ä»¥å¸®ä½ å†™ä¸€æ®µ ä¸€æ¡å‘½ä»¤æ£€æµ‹å¹¶æŠ¥é”™çš„è„šæœ¬ï¼Œè¦ä¸è¦æˆ‘å¸®ä½ åšä¸€ä¸ªï¼Ÿ

