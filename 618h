å¥½çš„ï¼ä½ å¸Œæœ›ç”¨ å¯†ç ç™»å½• + ä»è¿œç¨‹æ–‡ä»¶è¯»å–è·¯å¾„ + æ‹¼æ¥ + å®æ—¶ tail + å…³é”®è¯é€€å‡ºï¼Œä»¥ä¸‹æ˜¯å®Œæ•´å¯è¿è¡Œçš„ .gitlab-ci.yml ç¤ºä¾‹ï¼ŒåŸºäº sshpass + Alpine ç¯å¢ƒï¼š


---

âœ… GitLab CI ç¤ºä¾‹ï¼ˆä½¿ç”¨å¯†ç æ–¹å¼ï¼‰

image: alpine:latest

variables:
  SSH_USER: ec2-user
  REMOTE_HOST: 1.2.3.4
  REMOTE_PATH_A: /var/log/apps
  REMOTE_PATH_FILE: /tmp/path.txt
  SSH_PASSWORD: your_password_here  # æˆ–æ”¾åˆ° GitLab CI/CD å˜é‡ä¸­

before_script:
  - apk update && apk add sshpass openssh bash coreutils

tail_log:
  stage: tail_log
  script:
    - echo "é€šè¿‡ sshpass ç™»å½•è¿œç¨‹ä¸»æœºï¼Œè¯»å–è·¯å¾„å¹¶å®æ—¶ tail..."
    - |
      sshpass -p "$SSH_PASSWORD" ssh -o StrictHostKeyChecking=no $SSH_USER@$REMOTE_HOST 'bash -s' <<'EOF'
        set -e
        PATH_A="/var/log/apps"
        PATH_B=$(cat /tmp/path.txt)
        FULL_PATH="$PATH_A/$PATH_B"
        echo "æ—¥å¿—å®Œæ•´è·¯å¾„: $FULL_PATH"
        tail -n 0 -F "$FULL_PATH" | awk "/FINISH/ {print; exit} 1"
      EOF


---

ğŸ” å®‰å…¨è®¾ç½®å»ºè®®ï¼ˆGitLab CI/CDï¼‰

1. ä¸è¦æŠŠå¯†ç ç¡¬ç¼–ç åœ¨ .gitlab-ci.ymlï¼Œåº”è¯¥è¿™æ ·é…ç½®ï¼š



Key	Value	Options

SSH_PASSWORD	your_password	Masked + Protected
SSH_USER	ec2-user æˆ–å®é™…ç”¨æˆ·å	å¯é€‰å˜é‡
REMOTE_HOST	è¿œç¨‹æœåŠ¡å™¨ IP æˆ–åŸŸå	å¯é€‰å˜é‡



---

âœ… è¾“å‡ºæ•ˆæœç¤ºä¾‹

æ—¥å¿—å®Œæ•´è·¯å¾„: /var/log/apps/myapp.log
[20:30:00] job started
[20:30:01] doing stuff...
[20:30:02] FINISH

å½“ FINISH å‡ºç°åï¼Œawk ä¼šè§¦å‘ exitï¼ŒJob ç»“æŸã€‚


---

âš ï¸ æ³¨æ„äº‹é¡¹

é¡¹ç›®	å†…å®¹

ç™»å½•å¤±è´¥	æŠ¥é”™ Permission denied â†’ æ£€æŸ¥ç”¨æˆ·å/å¯†ç 
sshpass å®‰è£…å¤±è´¥	Alpine ä¸€å®šç”¨ apk add sshpass openssh
StrictHostKeyChecking=no	é˜²æ­¢é¦–æ¬¡ç™»å½•å¡ä½æç¤º
tail æ²¡è¾“å‡º	ç¡®ä¿ä½ è¯»çš„æ—¥å¿—æ–‡ä»¶æ˜¯æ´»è·ƒæ—¥å¿—ï¼ˆæŒç»­è¿½åŠ ï¼‰



---

å¦‚æœä½ è¿˜éœ€è¦åŠ ï¼š

è¶…æ—¶è‡ªåŠ¨é€€å‡º

è¾“å‡ºè¶…é•¿é™åˆ¶

å¤šæ–‡ä»¶ tail
æˆ‘å¯ä»¥å¸®ä½ æ‰©å±•ã€‚


æ˜¯å¦ä¹Ÿæƒ³åŠ ä¸€æ®µé€»è¾‘ï¼šå¦‚æœ /tmp/path.txt ä¸å­˜åœ¨ï¼Œå°± fail å¹¶æ‰“å°æŠ¥é”™ï¼Ÿ

