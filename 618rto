ä½ æƒ³é€šè¿‡ kubectl è·å–ï¼š

> âœ… Pod è¢«åˆ é™¤åé‡å»ºæ‰€éœ€çš„ RTOï¼ˆæ¢å¤æ—¶é—´ç›®æ ‡ï¼ŒRecovery Time Objectiveï¼‰ï¼Œå³ï¼š
ğŸ•’ Pod è¢«åˆ é™¤çš„æ—¶é—´ åˆ° æ–° Pod Ready çš„æ—¶é—´ä¹‹é—´çš„é—´éš”ã€‚




---

âœ… ç†è§£ç›®æ ‡

å‡è®¾ Pod å±äºä¸€ä¸ª Deployment/StatefulSetï¼Œè¢«è‡ªåŠ¨é‡å»ºï¼š

ä½ éœ€è¦ï¼š

1. è®°å½•æ—§ Pod è¢«åˆ é™¤çš„æ—¶é—´ã€‚


2. æ‰¾åˆ°æ–° Pod çš„åˆ›å»ºæ—¶é—´ã€‚


3. ç­‰å¾…ç›´åˆ°æ–° Pod Readyã€‚


4. è®¡ç®—æ—¶é—´å·®ï¼ˆRTOï¼‰ã€‚




---

âœ… æ–¹æ³•1ï¼šåŸºäºäº‹ä»¶ + Pod å¯åŠ¨çŠ¶æ€ï¼ˆå‘½ä»¤ç»„åˆï¼‰

ğŸ§ª ç¤ºä¾‹å‘½ä»¤æ­¥éª¤ï¼š

# è·å–æœ€è¿‘ Pod åˆ é™¤æ—¶é—´ï¼ˆç”¨äº‹ä»¶æŸ¥çœ‹ï¼‰
kubectl get event --sort-by=.lastTimestamp | grep -i delete | grep <pod-name>

> è¾“å‡ºå¦‚ï¼š
2025-06-18T02:34:12Z  Deleted pod my-app-abc123



ç„¶åæ‰¾åŒå ReplicaSet æ–°å¯åŠ¨çš„ Podï¼š

kubectl get pod -l app=my-app -o json | jq '.items[] | {name: .metadata.name, startTime: .status.startTime, conditions: .status.conditions}'

æˆ–è€…ç”¨ describeï¼š

kubectl describe pod <new-pod-name> | grep -A10 "Conditions"

æˆ–ï¼š

kubectl get pod <pod> -o=jsonpath='{.status.startTime}'
kubectl get pod <pod> -o=jsonpath='{.status.conditions[?(@.type=="Ready")].lastTransitionTime}'

ç„¶åä½ å¯ä»¥ç”¨ date å‘½ä»¤æ‰‹åŠ¨è®¡ç®—æ—¶é—´å·®ã€‚


---

âœ… æ–¹æ³•2ï¼šç”¨è„šæœ¬è‡ªåŠ¨è®¡ç®—æŸä¸ª Pod é‡å»º RTO

ğŸ§© å‡è®¾ä½ æœ‰ Pod labelï¼šapp=my-appï¼Œæˆ‘ä»¬åˆ é™¤æ—§ Pod å¹¶è®¡ç®—æ–° Pod Ready çš„è€—æ—¶ã€‚

#!/bin/bash

# è·å–å½“å‰ pod name
OLD_POD=$(kubectl get pod -l app=my-app -o jsonpath="{.items[0].metadata.name}")
echo "Old pod: $OLD_POD"

# è·å–æ—§ pod åˆ é™¤æ—¶é—´
DELETE_TIME=$(date +%s)
kubectl delete pod "$OLD_POD"

# ç­‰å¾…æ–° pod ready
echo "Waiting for new pod..."
kubectl wait --for=condition=Ready pod -l app=my-app --timeout=120s

# è·å–æ–° pod çš„åˆ›å»ºæ—¶é—´å’Œ ready æ—¶é—´
NEW_POD=$(kubectl get pod -l app=my-app -o jsonpath="{.items[0].metadata.name}")
START_TIME=$(kubectl get pod "$NEW_POD" -o jsonpath="{.status.startTime}")
READY_TIME=$(kubectl get pod "$NEW_POD" -o jsonpath="{.status.conditions[?(@.type=='Ready')].lastTransitionTime}")

# è½¬æ¢æ—¶é—´æ ¼å¼ä¸ºç§’
START_TIME_EPOCH=$(date -d "$START_TIME" +%s)
READY_TIME_EPOCH=$(date -d "$READY_TIME" +%s)

# è®¡ç®—è€—æ—¶
RTO=$((READY_TIME_EPOCH - DELETE_TIME))

echo "RTO: $RTO seconds (from delete to ready)"


---

âœ… æ–¹æ³•3ï¼šä½¿ç”¨ kubectl get events ç»“åˆ jq æˆ– grep

å¿«é€ŸæŸ¥çœ‹åˆ é™¤ + åˆ›å»º + Ready æ—¶é—´ï¼š

kubectl get events --sort-by=.lastTimestamp | grep -E 'Deleted|Created|Started|Ready' | grep my-app


---

â± æ€»ç»“

æ­¥éª¤	å·¥å…·

è·å–åˆ é™¤æ—¶é—´	kubectl get events æˆ– kubectl delete
è·å–æ–° pod åˆ›å»º/ready æ—¶é—´	kubectl get pod -o jsonpath
è‡ªåŠ¨åŒ–	ç”¨è„šæœ¬ï¼ˆå¦‚ bash + kubectl waitï¼‰
å‡†ç¡®æ€§	æœ€å‡†ç¡®çš„æ˜¯ Ready çš„ .lastTransitionTime å­—æ®µ



---

å¦‚æœä½ èƒ½æä¾› Pod çš„ Label æˆ–æ§åˆ¶å™¨ç±»å‹ï¼ˆDeployment/StatefulSetï¼‰ï¼Œæˆ‘å¯ä»¥å¸®ä½ å†™ä¸€ä¸ªå®Œå…¨è‡ªåŠ¨åŒ–çš„ RTO æ£€æµ‹è„šæœ¬ã€‚æ˜¯å¦éœ€è¦ï¼Ÿ

