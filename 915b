好的 👍 你说的是 AWS RDS Database Insights（新的名字，取代了 Performance Insights 的控制台），要在 AWS 自带的大盘（CloudWatch Dashboard） 展示 Top SQL、Top waits 这类数据，对吧？

我帮你捋清楚：


---

🔹 Database Insights 的数据

常规指标（CPU、内存、IO 等） → 来自 CloudWatch Metrics

数据库负载 / Top SQL / Top waits / Top users → 来自 Database Insights API (Performance Insights API)

主要是：

pi:GetResourceMetrics

pi:DescribeDimensionKeys

pi:GetDimensionKeyDetails




这些数据不会直接出现在 CloudWatch Metrics 里，但 Database Insights 控制台里支持 Export to CloudWatch Dashboard。


---

🔹 所需权限

最小 IAM Policy（读权限即可）：

{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "pi:GetResourceMetrics",
        "pi:DescribeDimensionKeys",
        "pi:GetDimensionKeyDetails",
        "rds:DescribeDBInstances",
        "cloudwatch:PutDashboard",
        "cloudwatch:GetDashboard",
        "cloudwatch:ListDashboards"
      ],
      "Resource": "*"
    }
  ]
}

👉 说明：

pi:* → 获取 SQL、wait events 等指标

rds:DescribeDBInstances → 列出 DB 实例

cloudwatch:*Dashboard → 能把 Database Insights 的视图导出到 CloudWatch 大盘



---

🔹 操作步骤（Database Insights → CloudWatch Dashboard）

1. 打开 RDS → Database Insights


2. 选择一个 DB 实例


3. 在 Metrics 或 Top SQL / Load 页面右上角，找到 “Add to dashboard / Export to CloudWatch”（不同 Region/Console 版本可能叫法不同）


4. 选择：

新建一个 CloudWatch Dashboard，或

追加到已有的 Dashboard



5. 保存后，在 CloudWatch → Dashboards 里就能看到 Top SQL / Top waits 等图表作为 widget 出现。




---

🔹 如果没有看到“导出”按钮

有可能原因：

实例没有启用 Database Insights Advanced（标准模式只显示有限指标）

使用的 AWS Region 暂时还没 rollout 完全（新功能分批推送）

IAM 权限不足（缺少 pi:Get* 或 cloudwatch:PutDashboard）



---

✅ 总结：
要在 AWS 大盘展示 Database Insights 的 Top SQL：

1. 确保实例启用 Database Insights


2. 角色要有 pi:* + cloudwatch:*Dashboard 权限


3. 在 Database Insights 控制台用 Export to CloudWatch Dashboard 功能添加 widget




---

要不要我帮你写一个 CloudWatch Dashboard JSON 模板，里面直接定义一个 Top SQL widget，你可以用 aws cloudwatch put-dashboard 部署？

