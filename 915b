å¥½çš„ ğŸ‘ ä½ è¯´çš„æ˜¯ AWS RDS Database Insightsï¼ˆæ–°çš„åå­—ï¼Œå–ä»£äº† Performance Insights çš„æ§åˆ¶å°ï¼‰ï¼Œè¦åœ¨ AWS è‡ªå¸¦çš„å¤§ç›˜ï¼ˆCloudWatch Dashboardï¼‰ å±•ç¤º Top SQLã€Top waits è¿™ç±»æ•°æ®ï¼Œå¯¹å§ï¼Ÿ

æˆ‘å¸®ä½ æ‹æ¸…æ¥šï¼š


---

ğŸ”¹ Database Insights çš„æ•°æ®

å¸¸è§„æŒ‡æ ‡ï¼ˆCPUã€å†…å­˜ã€IO ç­‰ï¼‰ â†’ æ¥è‡ª CloudWatch Metrics

æ•°æ®åº“è´Ÿè½½ / Top SQL / Top waits / Top users â†’ æ¥è‡ª Database Insights API (Performance Insights API)

ä¸»è¦æ˜¯ï¼š

pi:GetResourceMetrics

pi:DescribeDimensionKeys

pi:GetDimensionKeyDetails




è¿™äº›æ•°æ®ä¸ä¼šç›´æ¥å‡ºç°åœ¨ CloudWatch Metrics é‡Œï¼Œä½† Database Insights æ§åˆ¶å°é‡Œæ”¯æŒ Export to CloudWatch Dashboardã€‚


---

ğŸ”¹ æ‰€éœ€æƒé™

æœ€å° IAM Policyï¼ˆè¯»æƒé™å³å¯ï¼‰ï¼š

{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "pi:GetResourceMetrics",
        "pi:DescribeDimensionKeys",
        "pi:GetDimensionKeyDetails",
        "rds:DescribeDBInstances",
        "cloudwatch:PutDashboard",
        "cloudwatch:GetDashboard",
        "cloudwatch:ListDashboards"
      ],
      "Resource": "*"
    }
  ]
}

ğŸ‘‰ è¯´æ˜ï¼š

pi:* â†’ è·å– SQLã€wait events ç­‰æŒ‡æ ‡

rds:DescribeDBInstances â†’ åˆ—å‡º DB å®ä¾‹

cloudwatch:*Dashboard â†’ èƒ½æŠŠ Database Insights çš„è§†å›¾å¯¼å‡ºåˆ° CloudWatch å¤§ç›˜



---

ğŸ”¹ æ“ä½œæ­¥éª¤ï¼ˆDatabase Insights â†’ CloudWatch Dashboardï¼‰

1. æ‰“å¼€ RDS â†’ Database Insights


2. é€‰æ‹©ä¸€ä¸ª DB å®ä¾‹


3. åœ¨ Metrics æˆ– Top SQL / Load é¡µé¢å³ä¸Šè§’ï¼Œæ‰¾åˆ° â€œAdd to dashboard / Export to CloudWatchâ€ï¼ˆä¸åŒ Region/Console ç‰ˆæœ¬å¯èƒ½å«æ³•ä¸åŒï¼‰


4. é€‰æ‹©ï¼š

æ–°å»ºä¸€ä¸ª CloudWatch Dashboardï¼Œæˆ–

è¿½åŠ åˆ°å·²æœ‰çš„ Dashboard



5. ä¿å­˜åï¼Œåœ¨ CloudWatch â†’ Dashboards é‡Œå°±èƒ½çœ‹åˆ° Top SQL / Top waits ç­‰å›¾è¡¨ä½œä¸º widget å‡ºç°ã€‚




---

ğŸ”¹ å¦‚æœæ²¡æœ‰çœ‹åˆ°â€œå¯¼å‡ºâ€æŒ‰é’®

æœ‰å¯èƒ½åŸå› ï¼š

å®ä¾‹æ²¡æœ‰å¯ç”¨ Database Insights Advancedï¼ˆæ ‡å‡†æ¨¡å¼åªæ˜¾ç¤ºæœ‰é™æŒ‡æ ‡ï¼‰

ä½¿ç”¨çš„ AWS Region æš‚æ—¶è¿˜æ²¡ rollout å®Œå…¨ï¼ˆæ–°åŠŸèƒ½åˆ†æ‰¹æ¨é€ï¼‰

IAM æƒé™ä¸è¶³ï¼ˆç¼ºå°‘ pi:Get* æˆ– cloudwatch:PutDashboardï¼‰



---

âœ… æ€»ç»“ï¼š
è¦åœ¨ AWS å¤§ç›˜å±•ç¤º Database Insights çš„ Top SQLï¼š

1. ç¡®ä¿å®ä¾‹å¯ç”¨ Database Insights


2. è§’è‰²è¦æœ‰ pi:* + cloudwatch:*Dashboard æƒé™


3. åœ¨ Database Insights æ§åˆ¶å°ç”¨ Export to CloudWatch Dashboard åŠŸèƒ½æ·»åŠ  widget




---

è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ª CloudWatch Dashboard JSON æ¨¡æ¿ï¼Œé‡Œé¢ç›´æ¥å®šä¹‰ä¸€ä¸ª Top SQL widgetï¼Œä½ å¯ä»¥ç”¨ aws cloudwatch put-dashboard éƒ¨ç½²ï¼Ÿ

