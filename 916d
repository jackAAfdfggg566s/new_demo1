å¥½çš„ ğŸ‘ æˆ‘å¸®ä½ æ•´ç†ä¸€ä¸ªå®Œæ•´çš„ Lambda æ‰§è¡Œè§’è‰² (IAM Role) é…ç½®ï¼ŒåŒ…å« Trust Policy å’Œ Permissions Policyï¼Œä½ ç›´æ¥åœ¨ IAM é‡Œæ–°å»ºè§’è‰²å°±èƒ½ç”¨ã€‚


---

1. Trust Policy (è§’è‰²ä¿¡ä»»ç­–ç•¥)

Lambda éœ€è¦èƒ½å¤Ÿ AssumeRoleï¼Œæ‰€ä»¥è¦ä¿¡ä»» lambda.amazonaws.comï¼š

{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "Service": "lambda.amazonaws.com"
      },
      "Action": "sts:AssumeRole"
    }
  ]
}


---

2. Permissions Policy (è§’è‰²æƒé™ç­–ç•¥)

è®© Lambda èƒ½ï¼š

è°ƒç”¨ Performance Insights APIï¼ˆDatabase Insights åº•å±‚ä¾èµ–è¿™ä¸ª APIï¼‰

è·å– DB å®ä¾‹ä¿¡æ¯

å†™è‡ªå®šä¹‰æŒ‡æ ‡åˆ° CloudWatch

æŠŠæ—¥å¿—å†™åˆ° CloudWatch Logs


{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "pi:GetResourceMetrics",
        "pi:DescribeDimensionKeys",
        "pi:GetDimensionKeyDetails",
        "rds:DescribeDBInstances",
        "cloudwatch:PutMetricData",
        "logs:CreateLogGroup",
        "logs:CreateLogStream",
        "logs:PutLogEvents"
      ],
      "Resource": "*"
    }
  ]
}


---

âœ… ç”¨æ³•ï¼š

1. åœ¨ IAM â†’ Roles â†’ Create role é‡Œï¼š

é€‰æ‹© Trusted entity = Lambda

ç²˜è´´ä¸Šé¢çš„ Trust Policy



2. ç»™è¿™ä¸ªè§’è‰²é™„åŠ ä¸€ä¸ªè‡ªå®šä¹‰ Policyï¼ˆç”¨ä¸Šé¢ Permissions Policyï¼‰ã€‚


3. æŠŠè¿™ä¸ª Role ç»‘å®šåˆ°ä½ çš„ Lambdaã€‚




---

è¦ä¸è¦æˆ‘å†å¸®ä½ å†™ä¸€ä¸ª æœ€å°å¯è¿è¡Œ Lambda (Python boto3)ï¼Œç›´æ¥ç”¨ pi:GetResourceMetrics æ‹‰å–æŒ‡æ ‡ï¼ˆæ¯”å¦‚ SQL å»¶è¿Ÿï¼‰ï¼Œç„¶åå†™åˆ° CloudWatch â†’ Metrics â†’ RDS/TopSQLï¼Ÿè¿™æ ·ä½ èƒ½é©¬ä¸ŠéªŒè¯è§’è‰²æ˜¯å¦é…ç½®æ­£ç¡®ã€‚

