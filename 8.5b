æˆ‘æ˜ç™½ä½ çš„æ„æ€äº† ğŸ‘
ä½ æƒ³è¦æ ¹æ® Writer å®ä¾‹åï¼Œç„¶åæŸ¥å‡ºå®ƒå’Œ å…¶ä»–ä¸¤ä¸ª Reader å®ä¾‹çš„ AZ åˆ†å¸ƒã€‚

æˆ‘å¸®ä½ å†™ä¸¤ç§æ–¹å¼ï¼š


---

1ï¸âƒ£ å¦‚æœå·²ç»çŸ¥é“ 3 ä¸ªå®ä¾‹åï¼ˆWriter + 2 Readerï¼‰

ç›´æ¥ç”¨ describe-db-instances æŸ¥ä¸€éï¼š

aws rds describe-db-instances \
  --db-instance-identifier writer-instance-id \
  --db-instance-identifier reader1-instance-id \
  --db-instance-identifier reader2-instance-id \
  --query "DBInstances[*].[DBInstanceIdentifier,DBInstanceStatus,AvailabilityZone]" \
  --output table

è¾“å‡ºç¤ºä¾‹ï¼š

----------------------------------------------
|         DescribeDBInstances                |
+--------------------+-----------+-----------+
| writer-instance-id | available | ap-southeast-2a |
| reader1-instance-id| available | ap-southeast-2b |
| reader2-instance-id| available | ap-southeast-2c |
----------------------------------------------


---

2ï¸âƒ£ å¦‚æœåªçŸ¥é“ Writer å®ä¾‹åï¼Œè‡ªåŠ¨æŸ¥å‡º Readers

å…ˆé€šè¿‡ Writer æŸ¥å‡ºé›†ç¾¤ï¼Œç„¶åæŠŠæ‰€æœ‰å®ä¾‹æŸ¥å‡ºæ¥ï¼š

CLUSTER_ID=$(aws rds describe-db-instances \
  --db-instance-identifier writer-instance-id \
  --query "DBInstances[0].DBClusterIdentifier" \
  --output text)

aws rds describe-db-clusters \
  --db-cluster-identifier $CLUSTER_ID \
  --query "DBClusters[0].DBClusterMembers[*].DBInstanceIdentifier" \
  --output text | \
xargs -I {} aws rds describe-db-instances \
  --db-instance-identifier {} \
  --query "DBInstances[0].[DBInstanceIdentifier,DBInstanceStatus,AvailabilityZone]" \
  --output table

è¾“å‡ºç¤ºä¾‹ï¼š

----------------------------------------------
|         DescribeDBInstances                |
+--------------------+-----------+-----------+
| writer-instance-id | available | ap-southeast-2a |
| reader1-instance-id| available | ap-southeast-2b |
| reader2-instance-id| available | ap-southeast-2c |
----------------------------------------------


---

æˆ‘å¯ä»¥å¸®ä½ ä¼˜åŒ–æˆ ä¸€è¡Œå‘½ä»¤ï¼ˆç›´æ¥è¾“å…¥ Writer å®ä¾‹åï¼Œè‡ªåŠ¨è¾“å‡ºæ‰€æœ‰å®ä¾‹çš„ AZ åˆ†å¸ƒï¼‰ï¼Œè¿™æ ·è¿ç»´æŸ¥ AZ ä¸ç”¨æ‹†å‘½ä»¤ã€‚
è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸ªä¸€è¡Œç‰ˆï¼Ÿï¼ˆç²˜è´´å°±èƒ½ç”¨ï¼‰

